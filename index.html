<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="appTitle">Sistem Manajemen Qurban</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2lzdGVtIE1hbmFqZW1lbiBRdXJiYW4iLCJzaG9ydF9uYW1lIjoiUXVyYmFuIEFwcCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWU1ZjNkIiwidGhlbWVfY29sb3IiOiIjMWU1ZjNkIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1UQXdJaUJvWldsbmFIUTlJakV3TUNJZ2RtbGxkMEp2ZUQwaU1DQXdJREV3TUNBME1EQWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrUEdOcGNtTnNaU0JqZUQwaU5UQWlJR041UFNJMU1DSWdjajBpTkRVaUlHWnBiR3c5SWlNeE5UWm1NMlFpTHo0OGNHRjBhQ0JrUFNKTk16QWdOREFnVERVd0lESTFJRXczTUNBME1FdzNNQ0EzTUV3ek1DQTNNRm9pSUdacGJHdzlJbmRvYVhSbElpOCtQR05wY21Oc1pTQmplRDBpTlRBaUlHTjVQU0kxTlNJZ2NqMGlPQ0lnWm1sc2JEMGlJekZsTldZelpDSXZQand2YzNabkBnPT0iLCJzaXplcyI6IjE5Mng5NiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <meta name="theme-color" content="#1e5f3d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sistem Qurban">
    
    <!-- Script Ekspor PDF & XLSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <!-- Sistem Manajemen Qurban SDK -->
    <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyBzF7mPCEuDdWtaGb9G1zPZwmimRnDtc_o",
    authDomain: "website-panitiaqurbanmnf.firebaseapp.com",
    projectId: "website-panitiaqurbanmnf",
    storageBucket: "website-panitiaqurbanmnf.firebasestorage.app",
    messagingSenderId: "711397533943",
    appId: "1:711397533943:web:7aba6da6525d3350010bf2",
    measurementId: "G-0E8EYZP983"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
     const analytics = getAnalytics(app);
    </script>     


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f4c3a 0%, #1e5f3d 25%, #2d8659 75%, #3ea76b 100%);
            min-height: 100vh;
            direction: ltr;
            position: relative;
        }

        .islamic-pattern {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.05) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.03) 1px, transparent 1px),
                repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.02) 20px, rgba(255,255,255,0.02) 40px),
                repeating-linear-gradient(-45deg, transparent, transparent 20px, rgba(255,255,255,0.02) 20px, rgba(255,255,255,0.02) 40px);
            background-size: 50px 50px, 30px 30px, 80px 80px, 80px 80px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
        }

        .islamic-pattern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at top, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom, rgba(0,0,0,0.1) 0%, transparent 50%);
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 25px;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.25),
                0 0 0 1px rgba(255,255,255,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            width: 100%;
            max-width: 450px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #f4d03f, #d4af37);
            border-radius: 25px 25px 0 0;
        }

        .login-box h1 {
            color: #1e5f3d;
            margin-bottom: 8px;
            font-size: 32px;
            font-weight: 700;
            font-family: 'Amiri', serif;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: #1e5f3d;
            margin-bottom: 15px;
        }

        .islamic-greeting {
            color: #d4af37;
            font-size: 20px;
            margin-bottom: 35px;
            font-family: 'Amiri', serif;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e8f4f0;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 400;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .form-group input[type="file"] {
            padding: 12px 15px;
            background: rgba(248, 250, 252, 0.8);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 0 0 3px rgba(212, 175, 55, 0.1),
                0 4px 12px rgba(0,0,0,0.05);
            transform: translateY(-1px);
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 50%, #3ea76b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(30, 95, 61, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(30, 95, 61, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(30, 95, 61, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #94a3b8);
            margin-top: 12px;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.4);
        }

        /* Main Dashboard */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 25px 30px;
            border-radius: 20px;
            margin-bottom: 35px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.15),
                0 0 0 1px rgba(255,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37 0%, #f4d03f 25%, #d4af37 50%, #f4d03f 75%, #d4af37 100%);
            border-radius: 20px 20px 0 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            color: #1e5f3d;
            font-size: 28px;
            margin: 0;
            font-family: 'Amiri', serif;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 18px;
            color: #2d8659;
            font-weight: 600;
            background: rgba(46, 134, 89, 0.1);
            padding: 12px 20px;
            border-radius: 15px;
            border: 1px solid rgba(46, 134, 89, 0.2);
        }

        .logout-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #b91c1c, #dc2626);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 18px;
            padding: 10px;
            margin-bottom: 35px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.12),
                0 0 0 1px rgba(255,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            overflow-x: auto;
            position: relative;
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #d4af37, #f4d03f, #d4af37);
            border-radius: 18px 18px 0 0;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 24px;
            background: transparent;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-width: 140px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 50%, #3ea76b 100%);
            color: white;
            box-shadow: 
                0 6px 20px rgba(30, 95, 61, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: #d4af37;
            border-radius: 2px;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(30, 95, 61, 0.08);
            color: #1e5f3d;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.12),
                0 0 0 1px rgba(255,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #d4af37, #f4d03f, #d4af37);
            border-radius: 20px 20px 0 0;
        }

        .content-section.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            color: #1e5f3d;
            font-size: 26px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Amiri', serif;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 30px 25px;
            border-radius: 18px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #f4d03f, #d4af37);
            border-radius: 18px 18px 0 0;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.05) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: rgba(212, 175, 55, 0.4);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #1e5f3d;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: #64748b;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            margin-top: 25px;
            background: white;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 18px 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }

        th {
            background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 50%, #3ea76b 100%);
            color: white;
            font-weight: 700;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
            border-bottom: 2px solid #d4af37;
        }

        tr:nth-child(even) {
            background: rgba(248, 250, 252, 0.5);
        }

        tr:hover {
            background: rgba(212, 175, 55, 0.08);
            transform: translateX(2px);
            transition: all 0.2s ease;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-edit {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn-export {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .btn-export::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-export:hover::before {
            left: 100%;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
        }

        .btn-pdf:hover {
            background: linear-gradient(135deg, #b91c1c, #dc2626);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
        }

        .btn-excel {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
        }

        .btn-excel:hover {
            background: linear-gradient(135deg, #047857, #059669);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            margin: 3% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.25),
                0 0 0 1px rgba(255,255,255,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            position: relative;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #f4d03f, #d4af37);
            border-radius: 20px 20px 0 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
        }

        .modal-title {
            color: #1e5f3d;
            font-size: 24px;
            margin: 0;
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        .close {
            color: #64748b;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(100, 116, 139, 0.1);
        }

        .close:hover {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
            transform: rotate(90deg);
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            gap: 18px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 220px;
            padding: 14px 18px;
            border: 2px solid #e8f4f0;
            border-radius: 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .search-input:focus {
            outline: none;
            border-color: #d4af37;
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 0 0 3px rgba(212, 175, 55, 0.1),
                0 4px 12px rgba(0,0,0,0.05);
            transform: translateY(-1px);
        }

        .filter-select {
            padding: 14px 18px;
            border: 2px solid #e8f4f0;
            border-radius: 12px;
            font-size: 14px;
            min-width: 170px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .filter-select:focus {
            outline: none;
            border-color: #d4af37;
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 0 0 3px rgba(212, 175, 55, 0.1),
                0 4px 12px rgba(0,0,0,0.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .header-title {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .header-logo {
                min-width: auto;
            }

            .logo-image-header {
                max-height: 40px;
            }

            .header h1 {
                font-size: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-tab {
                flex: none;
                min-width: 100px;
                font-size: 12px;
                padding: 10px 15px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .export-buttons {
                flex-direction: column;
            }

            .search-filter {
                flex-direction: column;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
                padding: 15px;
                max-height: 90vh;
            }

            .table-container {
                font-size: 12px;
            }

            th, td {
                padding: 8px 4px;
                font-size: 11px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 4px;
            }

            .btn-small {
                font-size: 10px;
                padding: 4px 8px;
            }

            .user-info {
                flex-direction: column;
                gap: 8px;
                font-size: 14px;
            }

            .logout-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            /* Tiles responsive */
            .tiles-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .tile-card {
                margin-bottom: 10px;
            }

            .tile-preview {
                height: 150px;
            }

            .tile-info {
                padding: 15px;
            }

            .tile-title {
                font-size: 14px;
            }

            .tile-actions {
                flex-direction: column;
                gap: 8px;
            }

            .tile-btn {
                padding: 10px 16px;
                font-size: 13px;
                justify-content: center;
            }

            .tile-meta {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 18px;
            }

            .nav-tab {
                font-size: 11px;
                padding: 8px 12px;
                min-width: 80px;
            }

            .stat-number {
                font-size: 24px;
            }

            .modal-content {
                margin: 2% auto;
                width: 98%;
                padding: 10px;
            }

            .form-group label {
                font-size: 14px;
            }

            .form-group input, .form-group select, .form-group textarea {
                font-size: 14px;
                padding: 10px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255,255,255,.2);
            border-radius: 50%;
            border-top-color: #fff;
            border-right-color: rgba(255,255,255,.6);
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .message {
            padding: 20px 24px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 14px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .message.success {
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);
            color: #065f46;
            border: 1px solid rgba(167, 243, 208, 0.5);
        }

        .message.success::before {
            background: linear-gradient(180deg, #10b981, #059669);
        }

        .message.error {
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%);
            color: #991b1b;
            border: 1px solid rgba(252, 165, 165, 0.5);
        }

        .message.error::before {
            background: linear-gradient(180deg, #ef4444, #dc2626);
        }

        /* Gallery Styles */
        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Tiles Container Styles */
        .tiles-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .tile-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .tile-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .tile-preview {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tile-preview:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
        }

        .tile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .tile-preview:hover img {
            transform: scale(1.05);
        }

        .tile-icon {
            font-size: 64px;
            color: #64748b;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .tile-card:hover .tile-icon {
            color: #1e5f3d;
            transform: scale(1.1);
        }

        .tile-type {
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tile-info {
            padding: 20px;
            background: white;
        }

        .tile-title {
            font-weight: 700;
            color: #1e5f3d;
            margin-bottom: 8px;
            font-size: 16px;
            word-break: break-word;
            line-height: 1.4;
        }

        .tile-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 12px;
            color: #6b7280;
        }

        .tile-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tile-size {
            background: rgba(30, 95, 61, 0.1);
            color: #1e5f3d;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .tile-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .tile-btn {
            background: linear-gradient(135deg, #1e5f3d, #2d8659);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tile-btn:hover {
            background: linear-gradient(135deg, #0f4c3a, #1e5f3d);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 95, 61, 0.3);
        }

        .tile-btn.preview {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .tile-btn.preview:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
        }

        .tile-btn.download {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .tile-btn.download:hover {
            background: linear-gradient(135deg, #047857, #065f46);
        }

        .tile-btn.delete {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .tile-btn.delete:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .tile-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .empty-tiles {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            border: 2px dashed #cbd5e1;
        }

        .empty-tiles-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-tiles-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .empty-tiles-subtitle {
            font-size: 14px;
            opacity: 0.8;
        }

        .photo-card, .file-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .photo-card:hover, .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .photo-card img:hover {
            transform: scale(1.05);
        }

        .file-card-preview {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .file-card-preview:hover {
            background: #e2e8f0;
        }

        .file-card-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-icon {
            font-size: 48px;
            color: #64748b;
            margin-bottom: 10px;
        }

        .file-type {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
        }

        .photo-info, .file-info {
            padding: 15px;
        }

        .photo-title, .file-title {
            font-weight: 600;
            color: #1e5f3d;
            margin-bottom: 5px;
            font-size: 14px;
            word-break: break-word;
        }

        .photo-date, .file-date {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .photo-actions, .file-actions {
            display: flex;
            gap: 8px;
            justify-content: space-between;
            align-items: center;
        }

        .photo-size, .file-size {
            font-size: 11px;
            color: #9ca3af;
        }

        .delete-photo-btn, .delete-file-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s ease;
        }

        .delete-photo-btn:hover, .delete-file-btn:hover {
            background: #dc2626;
        }

        .download-photo-btn, .download-file-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s ease;
        }

        .download-photo-btn:hover, .download-file-btn:hover {
            background: #059669;
        }

        .preview-file-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s ease;
        }

        .preview-file-btn:hover {
            background: #2563eb;
        }

        /* Photo Modal */
        .photo-modal, .file-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
        }

        .photo-modal-content, .file-modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }

        .photo-modal img, .file-modal img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .file-modal iframe {
            width: 100%;
            height: 80vh;
            border: none;
            border-radius: 10px;
            background: white;
        }

        .file-modal-preview {
            background: white;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            color: #374151;
        }

        .file-modal-preview .file-icon {
            font-size: 64px;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .photo-modal-close, .file-modal-close {
            position: absolute;
            top: 10px;
            right: 25px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            z-index: 2001;
        }

        .photo-modal-close:hover, .file-modal-close:hover {
            color: #ef4444;
        }

        .photo-modal-info, .file-modal-info {
            color: white;
            margin-top: 15px;
            font-size: 14px;
        }

        /* Susunan Panitia Styles */
        .susunan-section {
            margin-bottom: 30px;
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #1e5f3d;
        }

        .susunan-title {
            color: #1e5f3d;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .susunan-content {
            line-height: 1.8;
            color: #374151;
            font-size: 14px;
        }

        .susunan-content h4 {
            color: #1e5f3d;
            margin: 15px 0 8px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .susunan-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .susunan-content li {
            margin: 5px 0;
        }

        /* Logo Styles */
        .logo-image-header {
            max-height: 50px;
            width: auto;
            border-radius: 8px;
            object-fit: contain;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .logo-image-login {
            max-height: 70px;
            width: auto;
            border-radius: 10px;
            object-fit: contain;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .logo-image-preview {
            max-height: 60px;
            max-width: 200px;
            border-radius: 8px;
            object-fit: contain;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Document Viewer Styles */
        .document-viewer {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .document-header {
            background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 50%, #3ea76b 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .document-info h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .document-info p {
            margin: 5px 0 0 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        .document-actions button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .document-actions button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .pdf-viewer {
            width: 100%;
            height: 600px;
            border: none;
        }

        .doc-preview {
            padding: 30px;
            background: #f8fafc;
            text-align: center;
            color: #64748b;
        }

        .doc-preview-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #3b82f6;
        }

        .doc-preview h4 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .doc-preview p {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .doc-download-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .doc-download-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .no-document {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            color: #64748b;
        }

        .no-document-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #94a3b8;
        }

        /* Print Styles */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            body {
                background: white !important;
                font-size: 12px;
                line-height: 1.4;
                margin: 0;
                padding: 15px;
            }
            
            .islamic-pattern,
            .nav-tabs,
            .export-buttons,
            .action-buttons,
            .btn,
            .search-filter,
            .header-content .user-info,
            .logout-btn {
                display: none !important;
            }
            
            .container {
                max-width: none;
                margin: 0;
                padding: 0;
            }
            
            .header {
                background: white !important;
                border-bottom: 2px solid #1e5f3d;
                margin-bottom: 20px;
                padding: 15px 0;
            }
            
            .header h1 {
                font-size: 18px !important;
                margin-bottom: 5px;
            }
            
            .content-section {
                display: block !important;
                box-shadow: none !important;
                border: none !important;
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .section-title {
                font-size: 16px !important;
                margin-bottom: 15px !important;
                border-bottom: 1px solid #1e5f3d;
                padding-bottom: 5px;
            }
            
            .stats-grid {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 10px !important;
                margin-bottom: 20px !important;
            }
            
            .stat-card {
                border: 1px solid #ccc !important;
                padding: 10px !important;
                text-align: center !important;
                background: #f8f9fa !important;
            }
            
            .stat-number {
                font-size: 18px !important;
                font-weight: bold !important;
                color: #1e5f3d !important;
            }
            
            .stat-label {
                font-size: 10px !important;
                color: #666 !important;
            }
            
            .table-container {
                overflow: visible !important;
                border-radius: 0 !important;
                box-shadow: none !important;
            }
            
            table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 10px !important;
                margin-top: 10px !important;
            }
            
            th, td {
                border: 1px solid #333 !important;
                padding: 6px 4px !important;
                text-align: left !important;
                vertical-align: top !important;
            }
            
            th {
                background: #1e5f3d !important;
                color: white !important;
                font-weight: bold !important;
                font-size: 9px !important;
            }
            
            tr:nth-child(even) {
                background: #f8f9fa !important;
            }
            
            .modal {
                display: none !important;
            }
            
            /* Page break settings */
            .content-section {
                page-break-inside: avoid;
            }
            
            table {
                page-break-inside: auto;
            }
            
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
            
            thead {
                display: table-header-group;
            }
            
            tfoot {
                display: table-footer-group;
            }
            
            /* Print header for each page */
            @page {
                margin: 1cm;
                @top-center {
                    content: "Sistem Manajemen Qurban";
                }
                @bottom-center {
                    content: "Halaman " counter(page);
                }
            }
            
            /* Hide elements that shouldn't be printed */
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="islamic-pattern"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="logo-display">
                <div>
                    <h1 id="loginTitle">Sistem Manajemen Qurban</h1>
                    <div id="loginSubtitle" style="color: #1e5f3d; font-size: 16px; margin-top: 3px; font-weight: 600;">Musholla Nurul Falah</div>
                </div>
            </div>
            
            <!-- Islamic ornament -->
            <div style="display: flex; justify-content: center; margin: 20px 0;">
                <svg width="120" height="20" viewBox="0 0 120 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 10 Q20 5 30 10 Q40 15 50 10 Q60 5 70 10 Q80 15 90 10 Q100 5 110 10" stroke="#d4af37" stroke-width="2" fill="none" opacity="0.7"/>
                    <circle cx="30" cy="10" r="2" fill="#d4af37" opacity="0.5"/>
                    <circle cx="60" cy="10" r="2" fill="#d4af37" opacity="0.5"/>
                    <circle cx="90" cy="10" r="2" fill="#d4af37" opacity="0.5"/>
                </svg>
            </div>
            

            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="btn">
                    <span id="loginText">Masuk</span>
                    <span id="loginLoading" class="loading" style="display: none;"></span>
                </button>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; font-size: 12px; color: #666;">
                  <strong>Akun Default:</strong><br>
                  Username: panitia / panitiaMNF<br>
                </div>
            </form>
            
            <div id="loginMessage" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" style="display: none;">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div class="header-title">
                        <div id="headerLogo" class="header-logo">
                            <!-- Logo will be inserted here by JavaScript -->
                        </div>
                        <div class="header-text">
                            <h1 id="headerTitle">Sistem Manajemen Qurban</h1>
                            <div id="headerOrganisasi" style="color: #2d8659; font-size: 14px; font-weight: 600;">Musholla Nurul Falah</div>
                            <div id="headerAlamat" style="color: #6b7280; font-size: 12px; margin-top: 2px;">Jl. Pahlawan RT.010/04 Sukabumi Selatan Kebon Jeruk Jakarta Barat</div>
                            <div style="color: #6b7280; font-size: 12px;" id="headerYear"></div>
                        </div>
                    </div>
                    <div class="user-info">
                        <span id="connectionStatus" style="font-size: 12px; color: #10b981;"> Online</span>
                        <span> <span id="currentUser">Admin</span></span>
                        <button class="logout-btn" id="logoutBtn">Keluar</button>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showSection('peserta')">Data Panitia</button>
                <button class="nav-tab" onclick="showSection('guru')">Data Guru</button>
                <button class="nav-tab" onclick="showSection('sapi')">Data Sapi</button>
                <button class="nav-tab" onclick="showSection('kambing')">Data Kambing</button>
                <button class="nav-tab" onclick="showSection('pembagian')">Data Mustahik</button>
                <button class="nav-tab" onclick="showSection('susunan')">Berkas Panitia</button>
                <button class="nav-tab" onclick="showSection('dokumentasi')">Dokumentasi</button>
                <button class="nav-tab" onclick="showSection('laporan')">Laporan</button>
                <button class="nav-tab" onclick="showSection('pengaturan')">Pengaturan</button>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <h2 class="section-title">Dashboard Qurban</h2>
                
                <div class="form-group" style="max-width: 200px; margin-bottom: 20px;">
                    <label>Filter Tahun Dashboard</label>
                    <select id="dashboardTahun" onchange="updateDashboard()">
                        <option value="semua">Semua Tahun</option>
                    </select>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPanitia">5</div>
                        <div class="stat-label">Total Panitia</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalGuru">0</div>
                        <div class="stat-label">Total Guru & Sepuh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalHewan">0</div>
                        <div class="stat-label">Total Seluruh Hewan Qurban</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSapi">0</div>
                        <div class="stat-label">Total Sapi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalKambing">0</div>
                        <div class="stat-label">Total Kambing</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPeserta">0</div>
                        <div class="stat-label">Total Peserta Qurban</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalMustahik">0</div>
                        <div class="stat-label">Total Mustahik</div>
                    </div>
                </div>

                <!-- Mustahik per RT Statistics -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span></span> Data Mustahik Per RT
                    </h3>
                    <div class="stats-grid" id="mustahikPerRTGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Islamic ornament separator -->
                <div style="display: flex; justify-content: center; margin: 30px 0;">
                    <svg width="200" height="30" viewBox="0 0 200 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="ornamentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#d4af37" stop-opacity="0.3"/>
                                <stop offset="50%" style="stop-color:#f4d03f" stop-opacity="0.8"/>
                                <stop offset="100%" style="stop-color:#d4af37" stop-opacity="0.3"/>
                            </linearGradient>
                        </defs>
                        <path d="M20 15 Q40 8 60 15 Q80 22 100 15 Q120 8 140 15 Q160 22 180 15" stroke="url(#ornamentGradient)" stroke-width="2" fill="none"/>
                        <circle cx="60" cy="15" r="3" fill="#d4af37" opacity="0.6"/>
                        <circle cx="100" cy="15" r="4" fill="#f4d03f" opacity="0.8"/>
                        <circle cx="140" cy="15" r="3" fill="#d4af37" opacity="0.6"/>
                        <!-- Small geometric patterns -->
                        <g opacity="0.4">
                            <path d="M30 10 L35 15 L30 20 L25 15 Z" fill="#d4af37"/>
                            <path d="M170 10 L175 15 L170 20 L165 15 Z" fill="#d4af37"/>
                        </g>
                    </svg>
                </div>

                <div class="message success">
                    <strong>  - Selamat datang!</strong> Sistem Manajemen Qurban Musholla Nurul Falah siap digunakan dengan penuh berkah. Mulai dengan menambahkan data panitia atau hewan qurban.
                    <p>Email : mnf.mushollanurulfalah.jakbar@gmail.com</p>
                </div>
            </div>

            <!-- Peserta Section -->
            <div id="peserta" class="content-section">
                <h2 class="section-title">Manajemen Data Panitia</h2>
                
                <button class="btn" onclick="openModal('pesertaModal')" style="width: auto; margin-bottom: 20px;">
                    Tambah Panitia Baru
                </button>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchPeserta" placeholder=" Cari panitia..." onkeyup="filterPeserta()">
                    <select class="filter-select" id="filterJenisPeserta" onchange="filterPeserta()">
                        <option value="">Semua Jabatan</option>
                        <option value="ketua">Ketua</option>
                        <option value="wakil">Wakil Ketua</option>
                        <option value="sekretaris">Sekretaris</option>
                        <option value="wakil-sekretaris">Wakil Sekretaris</option>
                        <option value="bendahara">Bendahara</option>
                        <option value="wakil-bendahara">Wakil Bendahara</option>
                        <option value="anggota">Anggota</option>
                    </select>
                    <select class="filter-select" id="filterTahunPeserta" onchange="filterPeserta()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div class="export-buttons">
                    <button class="btn-export btn-pdf" onclick="exportPesertaPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportPesertaExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printDataPanitia()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div class="table-container">
                    <table id="pesertaTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama</th>
                                <th>Jabatan</th>
                                <th>No. HP</th>
                                <th>Tahun</th>
                                <th>Status</th>
                                <th>Keterangan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="pesertaTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Berkas Panitia Section -->
            <div id="susunan" class="content-section">
                <h2 class="section-title"> Berkas Panitia</h2>
                
                <!-- Admin Upload Controls -->
                <div id="adminSusunanControls" style="margin-bottom: 25px;">
                    <div class="form-grid" style="max-width: 800px;">
                        <div class="form-group">
                            <label>Upload File Berkas Panitia (PDF saja)</label>
                            <input type="file" id="uploadSusunanFiles" accept=".pdf" multiple style="margin-bottom: 10px;">
                            <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">
                                Format yang didukung: PDF saja. Maksimal 10MB per file. Upload tidak terbatas.
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Tahun Berkas</label>
                            <select id="tahunBerkasPanitia">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                        <button class="btn" onclick="uploadSusunanFiles()" style="width: auto;">
                             Upload File
                        </button>
                        <button class="btn" onclick="loadSusunanPanitia()" style="width: auto; background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                             Refresh
                        </button>
                        <button class="btn btn-secondary" onclick="hapusSemuaFileSusunan()" style="width: auto;">
                             Hapus Semua File
                        </button>
                    </div>
                </div>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchBerkasPanitia" placeholder=" Cari berkas..." onkeyup="filterBerkasPanitia()">
                    <select class="filter-select" id="filterTahunSusunan" onchange="filterBerkasPanitia()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <strong>Total File: <span id="totalFileSusunan">0</span></strong>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">
                                Klik tile untuk melihat preview atau download. Admin dapat menghapus file.
                            </div>
                        </div>
                        <button class="btn-export" onclick="downloadAllSusunanFiles()" style="background: #10b981;">
                             Download Semua File
                        </button>
                    </div>
                </div>

                <!-- Files Display Area - Tiles Layout -->
                <div id="susunanFilesArea" class="tiles-container">
                    <!-- Uploaded files will be displayed here -->
                </div>
            </div>

            <!-- Guru Section -->
            <div id="guru" class="content-section">
                <h2 class="section-title">Manajemen Data Guru & Sepuh</h2>
                
                <button class="btn" onclick="openModal('guruModal')" style="width: auto; margin-bottom: 20px;">
                    Tambah Guru & Sepuh Baru
                </button>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchGuru" placeholder=" Cari guru & sepuh..." onkeyup="filterGuru()">
                    <select class="filter-select" id="filterJenisGuru" onchange="filterGuru()">
                        <option value="">Semua Kategori</option>
                        <option value="guru">Guru</option>
                        <option value="sepuh">Sepuh</option>
                        <option value="ustadz">Ustadz</option>
                        <option value="kyai">Kyai</option>
                    </select>
                    <select class="filter-select" id="filterTahunGuru" onchange="filterGuru()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div class="export-buttons">
                    <button class="btn-export btn-pdf" onclick="exportGuruPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportGuruExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printDataGuru()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div class="table-container">
                    <table id="guruTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama</th>
                                <th>Kategori</th>
                                <th>Tahun</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="guruTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sapi Section -->
            <div id="sapi" class="content-section">
                <h2 class="section-title">Manajemen Data Qurban Sapi</h2>
                
                <button class="btn" onclick="openModal('sapiModal')" style="width: auto; margin-bottom: 20px;">
                    Tambah Sapi Baru
                </button>

                <div class="search-filter">
                    <select class="filter-select" id="filterJenisSapi" onchange="filterSapi()">
                        <option value="">Semua Jenis Sapi</option>
                    </select>
                    <select class="filter-select" id="filterStatusSapi" onchange="filterSapi()">
                        <option value="">Semua Status</option>
                        <option value="tersedia">Tersedia</option>
                        <option value="penuh">Penuh</option>
                    </select>
                    <select class="filter-select" id="filterTahunSapi" onchange="filterSapi()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div class="export-buttons">
                    <button class="btn-export btn-pdf" onclick="exportSapiPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportSapiExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printDataSapi()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div class="table-container">
                    <table id="sapiTable">
                        <thead>
                            <tr>
                                <th>Nama Sapi</th>
                                <th>Peserta (7 bagian)</th>
                                <th>Tahun</th>
                                <th>Status</th>
                                <th>Keterangan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="sapiTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Kambing Section -->
            <div id="kambing" class="content-section">
                <h2 class="section-title">Manajemen Data Qurban Kambing</h2>
                
                <button class="btn" onclick="openModal('kambingModal')" style="width: auto; margin-bottom: 20px;">
                    Tambah Kambing Baru
                </button>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchKambing" placeholder=" Cari nama peserta qurban kambing..." onkeyup="filterKambing()">
                    <select class="filter-select" id="filterStatusKambing" onchange="filterKambing()">
                        <option value="">Semua Status</option>
                        <option value="tersedia">Tersedia</option>
                        <option value="terisi">Terisi</option>
                    </select>
                    <select class="filter-select" id="filterTahunKambing" onchange="filterKambing()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div class="export-buttons">
                    <button class="btn-export btn-pdf" onclick="exportKambingPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportKambingExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printDataKambing()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div class="table-container">
                    <table id="kambingTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Jenis Hewan</th>
                                <th>Peserta</th>
                                <th>Tahun</th>
                                <th>Status</th>
                                <th>Keterangan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="kambingTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pembagian Section -->
            <div id="pembagian" class="content-section">
                <h2 class="section-title">Manajemen Data Mustahik</h2>
                
                <button class="btn" onclick="openModal('pembagianModal')" style="width: auto; margin-bottom: 20px;">
                    Tambah Mustahik Baru
                </button>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchMustahik" placeholder=" Cari nama mustahik..." onkeyup="filterMustahik()">
                    <select class="filter-select" id="filterRTMustahik" onchange="filterMustahik()">
                        <option value="">Semua RT</option>
                    </select>
                    <select class="filter-select" id="filterStatusMustahik" onchange="filterMustahik()">
                        <option value="">Semua Status</option>
                        <option value="aktif">Aktif</option>
                        <option value="tidak-aktif">Tidak Aktif</option>
                    </select>
                    <select class="filter-select" id="filterTahunMustahik" onchange="filterMustahik()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div class="export-buttons">
                    <button class="btn-export btn-pdf" onclick="exportPembagianPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportPembagianExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printDataMustahik()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div class="table-container">
                    <table id="pembagianTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Mustahik</th>
                                <th>RT</th>
                                <th>Tahun</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="pembagianTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dokumentasi Section -->
            <div id="dokumentasi" class="content-section">
                <h2 class="section-title"> Dokumentasi Qurban</h2>
                
                <div id="adminDokumentasiControls" style="margin-bottom: 25px;">
                    <div class="form-grid" style="max-width: 800px;">
                        <div class="form-group">
                            <label>Upload Foto Dokumentasi (Upload tidak terbatas)</label>
                            <input type="file" id="uploadDokumentasi" accept="image/jpeg,image/jpg" multiple>
                            <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">
                                Format: JPG/JPEG saja. Maksimal 5MB per foto. Upload tidak terbatas.
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Tahun Dokumentasi</label>
                            <select id="tahunDokumentasi">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                        <button class="btn" onclick="uploadFotoDokumentasi()" style="width: auto;">
                             Upload Foto
                        </button>
                        <button class="btn" onclick="loadDokumentasiGallery()" style="width: auto; background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                             Refresh
                        </button>
                        <button class="btn btn-secondary" onclick="hapusSemuaFileDokumentasi()" style="width: auto;">
                             Hapus Semua Foto
                        </button>
                    </div>
                </div>

                <div class="search-filter">
                    <input type="text" class="search-input" id="searchDokumentasi" placeholder=" Cari foto..." onkeyup="filterDokumentasi()">
                    <select class="filter-select" id="filterTahunDokumentasi" onchange="filterDokumentasi()">
                        <option value="">Semua Tahun</option>
                    </select>
                </div>

                <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <strong>Total Foto: <span id="totalFoto">0</span></strong>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">
                                Klik tile untuk melihat foto ukuran penuh. Admin dapat menghapus foto.
                            </div>
                        </div>
                        <button class="btn-export" onclick="downloadAllPhotos()" style="background: #10b981;">
                             Download Semua Foto
                        </button>
                    </div>
                </div>

                <div id="dokumentasiGallery" class="tiles-container">
                    <!-- Photos will be loaded here -->
                </div>
            </div>

            <!-- Laporan Section -->
            <div id="laporan" class="content-section">
                <h2 class="section-title">Laporan Qurban</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Jenis Laporan</label>
                        <select id="jenisLaporan" onchange="generateLaporan()">
                            <option value="">Pilih Jenis Laporan</option>
                            <option value="panitia">Laporan Data Panitia</option>
                            <option value="guru">Laporan Data Guru & Sepuh</option>
                            <option value="mustahik">Laporan Data Mustahik</option>
                            <option value="mustahik-per-rt">Laporan Data Mustahik Per RT</option>
                            <option value="peserta-semua">Laporan Data Seluruh Peserta Qurban</option>
                            <option value="peserta-sapi">Laporan Data Peserta Qurban Sapi</option>
                            <option value="peserta-kambing">Laporan Data Peserta Qurban Kambing</option>
                            <option value="hewan-semua">Laporan Jumlah Seluruh Hewan</option>
                            <option value="hewan-sapi">Laporan Jumlah Sapi</option>
                            <option value="hewan-kambing">Laporan Jumlah Kambing</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tahun Laporan</label>
                        <select id="tahunLaporan">
                        </select>
                    </div>
                    <div class="form-group" id="rtFilterGroup" style="display: none;">
                        <label>Filter RT (untuk laporan mustahik)</label>
                        <select id="rtLaporanFilter">
                            <option value="">Semua RT</option>
                            <option value="RT10/04">RT10/04</option>
                            <option value="RT03/04">RT03/04</option>
                            <option value="RT04/04">RT04/04</option>
                            <option value="RT02/03">RT02/03</option>
                            <option value="RT03/03">RT03/03</option>
                        </select>
                    </div>
                </div>

                <div class="export-buttons">
                    <button class="btn-export" onclick="generateLaporan()" style="background: #10b981;">
                         Refresh Laporan
                    </button>
                    <button class="btn-export btn-pdf" onclick="exportLaporanPDF()">
                         Export PDF
                    </button>
                    <button class="btn-export btn-excel" onclick="exportLaporanExcel()">
                         Export Excel
                    </button>
                    <button class="btn-export" onclick="printLaporan()" style="background: #6366f1;">
                         Print
                    </button>
                </div>

                <div id="laporanContent" class="table-container">
                    <div style="text-align: center; padding: 50px; color: #6b7280;">
                        Pilih jenis laporan untuk menampilkan data
                    </div>
                </div>
            </div>

            <!-- Pengaturan Section -->
            <div id="pengaturan" class="content-section">
                <h2 class="section-title">Pengaturan Sistem</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nama Musholla</label>
                        <input type="text" id="namaOrganisasi" value="Musholla Nurul Falah">
                    </div>
                    <div class="form-group">
                        <label>Alamat Musholla</label>
                        <textarea id="alamatOrganisasi" rows="3">Jl. Pahlawan RT.010/04 Sukabumi Selatan Kebon Jeruk Jakarta Barat</textarea>
                    </div>
                    <div class="form-group">
                        <label>Judul Login Utama</label>
                        <input type="text" id="judulLoginUtama" value="Sistem Manajemen Qurban" placeholder="Sistem Manajemen Qurban">
                    </div>
                    <div class="form-group">
                        <label>Judul Login Sub</label>
                        <input type="text" id="judulLoginSub" value="Musholla Nurul Falah" placeholder="Nama organisasi">
                    </div>
                    <div class="form-group">
                        <label>Tahun Hijriah</label>
                        <input type="text" id="tahunHijriah" value="${currentHijriYear}">
                    </div>
                    <div class="form-group">
                        <label>Tahun Masehi</label>
                        <input type="text" id="tahunMasehi" value="${currentYear}">
                    </div>
                    <div class="form-group">
                        <label>Logo Musholla</label>
                        <input type="file" id="logoOrganisasi" accept="image/*">
                        <small style="color: #6b7280; font-size: 12px; margin-top: 5px; display: block;">
                            Format yang didukung: JPG, PNG, GIF (Maksimal 2MB)
                        </small>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Preview Logo Saat Ini</label>
                        <div id="logoPreview" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px; text-align: center; background: #f9fafb;">
                            <div id="currentLogoDisplay">
                                <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <linearGradient id="logoGradientPreview" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#1e5f3d"/>
                                            <stop offset="50%" style="stop-color:#2d8659"/>
                                            <stop offset="100%" style="stop-color:#3ea76b"/>
                                        </linearGradient>
                                        <linearGradient id="goldGradientPreview" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#d4af37"/>
                                            <stop offset="50%" style="stop-color:#f4d03f"/>
                                            <stop offset="100%" style="stop-color:#d4af37"/>
                                        </linearGradient>
                                    </defs>
                                    <circle cx="50" cy="50" r="45" fill="url(#logoGradientPreview)" stroke="url(#goldGradientPreview)" stroke-width="2"/>
                                    <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white" opacity="0.95"/>
                                    <circle cx="50" cy="55" r="8" fill="url(#logoGradientPreview)"/>
                                    <path d="M42 75 L58 75" stroke="white" stroke-width="3" stroke-linecap="round"/>
                                    <g opacity="0.3">
                                        <path d="M20 20 L30 30 M70 30 L80 20 M20 80 L30 70 M70 70 L80 80" stroke="url(#goldGradientPreview)" stroke-width="1"/>
                                    </g>
                                </svg>
                            </div>
                            <div style="margin-top: 10px; color: #6b7280; font-size: 12px;">Logo Default</div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="simpanPengaturan()" style="width: auto;">
                         Simpan Pengaturan
                    </button>
                    <button class="btn btn-secondary" onclick="hapusLogo()" style="width: auto;">
                         Hapus Logo
                    </button>
                </div>

                <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e5e7eb;">
                    <h3 style="color: #1e5f3d; margin-bottom: 15px;">Backup & Restore Data</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn-export btn-excel" onclick="backupData()">
                             Backup Data
                        </button>
                        <button class="btn-export" onclick="document.getElementById('restoreFile').click()" style="background: #f59e0b;">
                             Restore Data
                        </button>
                        <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(this)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Peserta -->
    <div id="pesertaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah/Edit Data Panitia</h3>
                <span class="close" onclick="closeModal('pesertaModal')">&times;</span>
            </div>
            <form id="pesertaForm">
                <input type="hidden" id="pesertaId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nama Lengkap *</label>
                        <input type="text" id="namaPeserta" required>
                    </div>
                    <div class="form-group">
                        <label>Jabatan *</label>
                        <select id="jenisPeserta" required>
                            <option value="">Pilih Jabatan</option>
                            <option value="ketua">Ketua</option>
                            <option value="wakil">Wakil Ketua</option>
                            <option value="sekretaris">Sekretaris</option>
                            <option value="wakil-sekretaris">Wakil Sekretaris</option>
                            <option value="bendahara">Bendahara</option>
                            <option value="wakil-bendahara">Wakil Bendahara</option>
                            <option value="anggota">Anggota</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>No. HP *</label>
                        <input type="tel" id="teleponPeserta" required>
                    </div>
                    <div class="form-group">
                        <label>Tahun *</label>
                        <select id="tahunPeserta" required>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="statusPembayaran">
                            <option value="aktif">Aktif</option>
                            <option value="tidak-aktif">Tidak Aktif</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Keterangan</label>
                        <textarea id="keteranganPeserta" rows="3" placeholder="Keterangan tambahan..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn"> Simpan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('pesertaModal')"> Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Guru -->
    <div id="guruModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah/Edit Data Guru & Sepuh</h3>
                <span class="close" onclick="closeModal('guruModal')">&times;</span>
            </div>
            <form id="guruForm">
                <input type="hidden" id="guruId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nama Lengkap *</label>
                        <input type="text" id="namaGuru" required>
                    </div>
                    <div class="form-group">
                        <label>Kategori *</label>
                        <select id="jenisGuru" required>
                            <option value="">Pilih Kategori</option>
                            <option value="guru">Guru</option>
                            <option value="sepuh">Sepuh</option>
                            <option value="ustadz">Ustadz</option>
                            <option value="kyai">Kyai</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tahun *</label>
                        <select id="tahunGuru" required>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="statusGuru">
                            <option value="aktif">Aktif</option>
                            <option value="tidak-aktif">Tidak Aktif</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn"> Simpan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('guruModal')"> Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Sapi -->
    <div id="sapiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah/Edit Data Sapi Qurban</h3>
                <span class="close" onclick="closeModal('sapiModal')">&times;</span>
            </div>
            <form id="sapiForm">
                <input type="hidden" id="sapiId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Jenis Sapi *</label>
                        <select id="jenisSapi" required>
                            <option value="">Pilih Jenis Sapi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tahun *</label>
                        <select id="tahunSapi" required>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Keterangan</label>
                        <textarea id="keteranganSapi" rows="3" placeholder="Ciri-ciri, asal, dll..."></textarea>
                    </div>
                </div>
                
                <h4 style="color: #1e5f3d; margin: 20px 0 15px 0;">Daftar Peserta (7 Bagian)</h4>
                <div id="pesertaSapiContainer">
                    <!-- 7 input fields for peserta will be generated here -->
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn"> Simpan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('sapiModal')"> Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Kambing -->
    <div id="kambingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah/Edit Data Kambing Qurban</h3>
                <span class="close" onclick="closeModal('kambingModal')">&times;</span>
            </div>
            <form id="kambingForm">
                <input type="hidden" id="kambingId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Jenis Hewan *</label>
                        <select id="jenisKambing" required>
                            <option value="">Pilih Jenis</option>
                            <option value="kambing">Kambing</option>
                            <option value="domba">Domba</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nama Peserta</label>
                        <input type="text" id="pesertaKambing" placeholder="Nama peserta qurban">
                    </div>
                    <div class="form-group">
                        <label>Tahun *</label>
                        <select id="tahunKambing" required>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Keterangan</label>
                        <textarea id="keteranganKambing" rows="3" placeholder="Ciri-ciri, asal, dll..."></textarea>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn"> Simpan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('kambingModal')"> Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Pembagian -->
    <div id="pembagianModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah/Edit Data Mustahik</h3>
                <span class="close" onclick="closeModal('pembagianModal')">&times;</span>
            </div>
            <form id="pembagianForm">
                <input type="hidden" id="mustahikId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nama Mustahik *</label>
                        <input type="text" id="namaMustahik" required placeholder="Nama lengkap mustahik">
                    </div>
                    <div class="form-group">
                        <label>RT *</label>
                        <select id="rtMustahik" required>
                            <option value="">Pilih RT</option>
                            <option value="RT10/04">RT10/04</option>
                            <option value="RT03/04">RT03/04</option>
                            <option value="RT04/04">RT04/04</option>
                            <option value="RT02/03">RT02/03</option>
                            <option value="RT03/03">RT03/03</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tahun *</label>
                        <select id="tahunMustahik" required>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="statusMustahik">
                            <option value="aktif">Aktif</option>
                            <option value="tidak-aktif">Tidak Aktif</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn"> Simpan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('pembagianModal')"> Batal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Photo Modal -->
    <div id="photoModal" class="photo-modal">
        <div class="photo-modal-content">
            <span class="photo-modal-close" onclick="closePhotoModal()">&times;</span>
            <img id="modalPhoto" src="" alt="Photo">
            <div id="modalPhotoInfo" class="photo-modal-info"></div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="fileModal" class="file-modal">
        <div class="file-modal-content">
            <span class="file-modal-close" onclick="closeFileModal()">&times;</span>
            <div id="fileModalContent"></div>
            <div id="modalFileInfo" class="file-modal-info"></div>
        </div>
    </div>

    <script>
        // Data Storage
        let pesertaData = JSON.parse(localStorage.getItem('pesertaData')) || [];
        let guruData = JSON.parse(localStorage.getItem('guruData')) || [];
        let sapiData = JSON.parse(localStorage.getItem('sapiData')) || [];
        let kambingData = JSON.parse(localStorage.getItem('kambingData')) || [];
        let mustahikData = JSON.parse(localStorage.getItem('mustahikData')) || [];
        let dokumentasiData = JSON.parse(localStorage.getItem('dokumentasiData')) || [];
        let susunanFilesData = JSON.parse(localStorage.getItem('susunanFilesData')) || [];
        let currentUser = null;
        let userRole = null;
        
        // Get current year dynamically
        const currentYear = new Date().getFullYear();
        const currentHijriYear = currentYear - 579; // Approximate conversion
        
        // Initialize year dropdowns
        function initializeYearDropdowns() {
            const yearOptions = [];
            const filterYearOptions = [];
            for (let i = 0; i < 4; i++) {
                const year = currentYear - i;
                yearOptions.push(`<option value="${year}"${i === 0 ? ' selected' : ''}>${year}</option>`);
                filterYearOptions.push(`<option value="${year}">${year}</option>`);
            }
            
            // Dashboard filter
            const dashboardSelect = document.getElementById('dashboardTahun');
            dashboardSelect.innerHTML = '<option value="semua">Semua Tahun</option>' + yearOptions.join('');
            
            // Form dropdowns
            document.getElementById('tahunPeserta').innerHTML = yearOptions.join('');
            document.getElementById('tahunGuru').innerHTML = yearOptions.join('');
            document.getElementById('tahunSapi').innerHTML = yearOptions.join('');
            document.getElementById('tahunKambing').innerHTML = yearOptions.join('');
            document.getElementById('tahunMustahik').innerHTML = yearOptions.join('');
            
            // Filter dropdowns
            const filterYearOptionsWithAll = '<option value="">Semua Tahun</option>' + filterYearOptions.join('');
            document.getElementById('filterTahunPeserta').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunGuru').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunSapi').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunKambing').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunMustahik').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunSusunan').innerHTML = filterYearOptionsWithAll;
            document.getElementById('filterTahunDokumentasi').innerHTML = filterYearOptionsWithAll;
            
            // Upload year dropdowns for berkas and dokumentasi
            document.getElementById('tahunBerkasPanitia').innerHTML = yearOptions.join('');
            document.getElementById('tahunDokumentasi').innerHTML = yearOptions.join('');
            
            // Laporan dropdown with Hijri years
            const laporanOptions = [];
            for (let i = 0; i < 4; i++) {
                const year = currentYear - i;
                const hijriYear = currentHijriYear - i;
                laporanOptions.push(`<option value="${year}"${i === 0 ? ' selected' : ''}>${year} (${hijriYear} H)</option>`);
            }
            document.getElementById('tahunLaporan').innerHTML = laporanOptions.join('');
            
            // Update header year display
            document.getElementById('headerYear').textContent = `Tahun ${currentHijriYear} H / ${currentYear} M`;
        }
        
        let pengaturanData = JSON.parse(localStorage.getItem('pengaturanData')) || {
            namaOrganisasi: 'Musholla Nurul Falah',
            alamatOrganisasi: 'Jl. Pahlawan RT.010/04 Sukabumi Selatan Kebon Jeruk Jakarta Barat',
            judulLoginUtama: 'Sistem Manajemen Qurban',
            judulLoginSub: 'Musholla Nurul Falah',
            tahunHijriah: currentHijriYear.toString(),
            tahunMasehi: currentYear.toString()
        };

        // Authentication
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Show loading
            document.getElementById('loginText').style.display = 'none';
            document.getElementById('loginLoading').style.display = 'inline-block';
            
            // Simulate login process
            setTimeout(() => {
                if ((username === 'admin' && password === 'MNF2025') || 
                    (username === 'panitia' && password === 'panitiaMNF')) {
                    
                    currentUser = username;
                    userRole = username === 'admin' ? 'admin' : 'panitia';
                    
                    document.getElementById('currentUser').textContent = username;
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('mainDashboard').style.display = 'block';
                    
                    // Initialize year dropdowns
                    initializeYearDropdowns();
                    
                    // Setup UI based on role
                    setupUserInterface();
                    updateDashboard();
                } else {
                    document.getElementById('loginMessage').innerHTML = 
                        '<div class="message error">Username atau password salah!</div>';
                }
                
                // Hide loading
                document.getElementById('loginText').style.display = 'inline';
                document.getElementById('loginLoading').style.display = 'none';
            }, 1000);
        }

        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                // Clear user data
                currentUser = null;
                userRole = null;
                
                // Reset UI
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainDashboard').style.display = 'none';
                document.getElementById('loginForm').reset();
                document.getElementById('loginMessage').innerHTML = '';
                
                // Reset to dashboard tab
                const sections = document.querySelectorAll('.content-section');
                sections.forEach(section => section.classList.remove('active'));
                document.getElementById('dashboard').classList.add('active');
                
                const tabs = document.querySelectorAll('.nav-tab');
                tabs.forEach(tab => tab.classList.remove('active'));
                tabs[0].classList.add('active');
            }
        }

        function setupUserInterface() {
            const addButtons = document.querySelectorAll('button[onclick*="openModal"]');
            const actionButtons = document.querySelectorAll('.btn-small');
            const pengaturanTab = document.querySelector('button[onclick="showSection(\'pengaturan\')"]');
            const adminDokumentasiControls = document.getElementById('adminDokumentasiControls');
            const adminSusunanControls = document.getElementById('adminSusunanControls');
            
            if (userRole === 'panitia') {
                // Hide add buttons for panitia (except documentation upload)
                addButtons.forEach(btn => {
                    if (btn.textContent.includes('Tambah')) {
                        btn.style.display = 'none';
                    }
                });
                
                // Hide action buttons (edit/delete) for panitia
                setTimeout(() => {
                    const actionBtns = document.querySelectorAll('.action-buttons');
                    actionBtns.forEach(btn => btn.style.display = 'none');
                }, 100);
                
                // Hide pengaturan tab for panitia
                if (pengaturanTab) {
                    pengaturanTab.style.display = 'none';
                }
                
                // Show documentation upload controls for panitia (but hide delete all button)
                if (adminDokumentasiControls) {
                    adminDokumentasiControls.style.display = 'block';
                    // Hide delete all button for panitia
                    const deleteAllBtn = adminDokumentasiControls.querySelector('button[onclick="hapusSemuaFileDokumentasi()"]');
                    if (deleteAllBtn) {
                        deleteAllBtn.style.display = 'none';
                    }
                }
                
                // Hide admin susunan controls for panitia
                if (adminSusunanControls) {
                    adminSusunanControls.style.display = 'none';
                }
            } else {
                // Show all buttons for admin
                addButtons.forEach(btn => btn.style.display = '');
                setTimeout(() => {
                    const actionBtns = document.querySelectorAll('.action-buttons');
                    actionBtns.forEach(btn => btn.style.display = '');
                }, 100);
                if (pengaturanTab) {
                    pengaturanTab.style.display = '';
                }
                
                // Show admin documentation controls for admin
                if (adminDokumentasiControls) {
                    adminDokumentasiControls.style.display = 'block';
                    // Show delete all button for admin
                    const deleteAllBtn = adminDokumentasiControls.querySelector('button[onclick="hapusSemuaFileDokumentasi()"]');
                    if (deleteAllBtn) {
                        deleteAllBtn.style.display = '';
                    }
                }
                
                // Show admin susunan controls for admin
                if (adminSusunanControls) {
                    adminSusunanControls.style.display = 'block';
                }
            }
        }

        // Navigation
        function showSection(sectionName) {
            // Check permissions for panitia
            if (userRole === 'panitia' && sectionName === 'pengaturan') {
                alert('Anda tidak memiliki akses ke halaman pengaturan!');
                return;
            }
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load section-specific data and setup permissions
            if (sectionName === 'peserta') {
                loadPesertaTable();
                setupUserInterface();
            } else if (sectionName === 'susunan') {
                loadSusunanPanitia();
                setupUserInterface();
            } else if (sectionName === 'guru') {
                loadGuruTable();
                setupUserInterface();
            } else if (sectionName === 'sapi') {
                loadSapiTable();
                setupUserInterface();
            } else if (sectionName === 'kambing') {
                loadKambingTable();
                setupUserInterface();
            } else if (sectionName === 'pembagian') {
                loadPembagianTable();
                populateMustahikFilters();
                setupUserInterface();
            } else if (sectionName === 'dokumentasi') {
                loadDokumentasiGallery();
                setupUserInterface();
            } else if (sectionName === 'dashboard') {
                updateDashboard();
            }
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            if (modalId === 'sapiModal') {
                generatePesertaSapiInputs();
                populateSapiDropdown();
            } else if (modalId === 'guruModal') {
                // Initialize guru form year dropdown
                const tahunGuru = document.getElementById('tahunGuru');
                if (tahunGuru && tahunGuru.innerHTML === '') {
                    initializeYearDropdowns();
                }
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset forms
            if (modalId === 'pesertaModal') {
                document.getElementById('pesertaForm').reset();
                document.getElementById('pesertaId').value = '';
            } else if (modalId === 'guruModal') {
                document.getElementById('guruForm').reset();
                document.getElementById('guruId').value = '';
            } else if (modalId === 'sapiModal') {
                document.getElementById('sapiForm').reset();
                document.getElementById('sapiId').value = '';
                document.getElementById('jenisSapi').value = '';
            } else if (modalId === 'kambingModal') {
                document.getElementById('kambingForm').reset();
                document.getElementById('kambingId').value = '';
            } else if (modalId === 'pembagianModal') {
                document.getElementById('pembagianForm').reset();
                document.getElementById('mustahikId').value = '';
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            const tahunFilter = document.getElementById('dashboardTahun').value;
            
            // Filter data berdasarkan tahun
            let filteredPanitia = pesertaData;
            let filteredSapi = sapiData;
            let filteredKambing = kambingData;
            let filteredMustahik = mustahikData;
            
            if (tahunFilter !== 'semua') {
                filteredPanitia = pesertaData.filter(p => p.tahun === tahunFilter);
                filteredSapi = sapiData.filter(s => s.tahun === tahunFilter);
                filteredKambing = kambingData.filter(k => k.tahun === tahunFilter);
                filteredMustahik = mustahikData.filter(m => m.tahun === tahunFilter);
            }
            
            // Total Panitia
            document.getElementById('totalPanitia').textContent = filteredPanitia.length;
            
            // Total Guru & Sepuh
            let filteredGuru = guruData;
            if (tahunFilter !== 'semua') {
                filteredGuru = guruData.filter(g => g.tahun === tahunFilter);
            }
            document.getElementById('totalGuru').textContent = filteredGuru.length;
            
            // Total Hewan
            const totalHewan = filteredSapi.length + filteredKambing.length;
            document.getElementById('totalHewan').textContent = totalHewan;
            
            // Total Sapi
            document.getElementById('totalSapi').textContent = filteredSapi.length;
            
            // Total Kambing
            document.getElementById('totalKambing').textContent = filteredKambing.length;
            
            // Total Peserta Qurban (7 per sapi + 1 per kambing)
            const totalPesertaSapi = filteredSapi.reduce((sum, sapi) => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                return sum + pesertaTerisi;
            }, 0);
            const totalPesertaKambing = filteredKambing.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '').length;
            document.getElementById('totalPeserta').textContent = totalPesertaSapi + totalPesertaKambing;
            
            // Total Mustahik
            document.getElementById('totalMustahik').textContent = filteredMustahik.length;
            
            // Update Mustahik per RT statistics
            updateMustahikPerRTStats(filteredMustahik);
        }

        function updateMustahikPerRTStats(filteredMustahik) {
            const mustahikPerRTGrid = document.getElementById('mustahikPerRTGrid');
            
            // Group mustahik by RT
            const mustahikByRT = {};
            const rtOptions = ['RT10/04', 'RT03/04', 'RT04/04', 'RT02/03', 'RT03/03'];
            
            // Initialize all RT with 0
            rtOptions.forEach(rt => {
                mustahikByRT[rt] = 0;
            });
            
            // Count mustahik per RT
            filteredMustahik.forEach(mustahik => {
                const rt = mustahik.rt || 'Lainnya';
                if (mustahikByRT.hasOwnProperty(rt)) {
                    mustahikByRT[rt]++;
                } else {
                    mustahikByRT['Lainnya'] = (mustahikByRT['Lainnya'] || 0) + 1;
                }
            });
            
            // Generate RT cards
            let rtCards = '';
            Object.keys(mustahikByRT).forEach(rt => {
                const count = mustahikByRT[rt];
                const cardColor = count > 0 ? '#10b981' : '#6b7280';
                rtCards += `
                    <div class="stat-card">
                        <div class="stat-number" style="color: ${cardColor};">${count}</div>
                        <div class="stat-label">${rt}</div>
                    </div>
                `;
            });
            
            mustahikPerRTGrid.innerHTML = rtCards;
        }

        // Guru Functions
        function handleGuruSubmit(event) {
            event.preventDefault();
            
            const guruId = document.getElementById('guruId').value;
            const guru = {
                id: guruId || Date.now().toString(),
                nama: document.getElementById('namaGuru').value,
                kategori: document.getElementById('jenisGuru').value,
                tahun: document.getElementById('tahunGuru').value,
                status: document.getElementById('statusGuru').value,
                tanggalDaftar: guruId ? 
                    guruData.find(g => g.id === guruId).tanggalDaftar : 
                    new Date().toISOString().split('T')[0]
            };
            
            if (guruId) {
                // Update existing
                const index = guruData.findIndex(g => g.id === guruId);
                guruData[index] = guru;
            } else {
                // Add new
                guruData.push(guru);
            }
            
            localStorage.setItem('guruData', JSON.stringify(guruData));
            loadGuruTable();
            closeModal('guruModal');
            updateDashboard();
        }

        function loadGuruTable() {
            const tbody = document.getElementById('guruTableBody');
            tbody.innerHTML = '';
            
            guruData.forEach((guru, index) => {
                const statusBadge = getStatusBadgePanitia(guru.status);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${guru.nama}</td>
                        <td>${guru.kategori || '-'}</td>
                        <td>${guru.tahun || '2024'}</td>
                        <td>${statusBadge}</td>
                        <td class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editGuru('${guru.id}')"></button>
                            <button class="btn-small btn-delete" onclick="deleteGuru('${guru.id}')"></button>
                        </td>
                    </tr>
                `;
            });
        }

        function editGuru(id) {
            const guru = guruData.find(g => g.id === id);
            if (guru) {
                document.getElementById('guruId').value = guru.id;
                document.getElementById('namaGuru').value = guru.nama;
                document.getElementById('jenisGuru').value = guru.kategori || '';
                document.getElementById('tahunGuru').value = guru.tahun || currentYear.toString();
                document.getElementById('statusGuru').value = guru.status || 'aktif';
                
                openModal('guruModal');
            }
        }

        function deleteGuru(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data guru & sepuh ini?')) {
                guruData = guruData.filter(g => g.id !== id);
                localStorage.setItem('guruData', JSON.stringify(guruData));
                loadGuruTable();
                updateDashboard();
            }
        }

        function filterGuru() {
            const searchTerm = document.getElementById('searchGuru').value.toLowerCase();
            const jenisFilter = document.getElementById('filterJenisGuru').value;
            const tahunFilter = document.getElementById('filterTahunGuru').value;
            
            const rows = document.querySelectorAll('#guruTableBody tr');
            rows.forEach(row => {
                const nama = row.cells[1].textContent.toLowerCase();
                const kategori = row.cells[2].textContent.toLowerCase();
                const tahun = row.cells[3].textContent;
                
                const matchSearch = nama.includes(searchTerm);
                const matchKategori = !jenisFilter || kategori === jenisFilter;
                const matchTahun = !tahunFilter || tahun === tahunFilter;
                
                row.style.display = matchSearch && matchKategori && matchTahun ? '' : 'none';
            });
        }

        function exportGuruPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('LAPORAN DATA GURU & SEPUH', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`${pengaturanData.namaOrganisasi}`, 105, 30, { align: 'center' });
            doc.text(`${pengaturanData.alamatOrganisasi}`, 105, 38, { align: 'center' });
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 105, 46, { align: 'center' });
            
            // Line separator
            doc.setLineWidth(0.5);
            doc.line(20, 52, 190, 52);
            
            const tableData = guruData.map((guru, index) => [
                index + 1,
                guru.nama,
                guru.kategori || '-',
                guru.tahun || '2024',
                guru.status || 'aktif'
            ]);
            
            doc.autoTable({
                head: [['No', 'Nama', 'Kategori', 'Tahun', 'Status']],
                body: tableData,
                startY: 58,
                styles: { 
                    fontSize: 10,
                    cellPadding: 3,
                    halign: 'left'
                },
                headStyles: {
                    fillColor: [30, 95, 61],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [245, 245, 245]
                },
                margin: { left: 20, right: 20 }
            });
            
            // Footer
            const finalY = doc.lastAutoTable.finalY + 20;
            doc.setFontSize(10);
            doc.text(`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`, 20, finalY);
            doc.text(`Total Data: ${guruData.length} orang`, 20, finalY + 8);
            
            doc.save('laporan-guru-sepuh.pdf');
        }

        function exportGuruExcel() {
            // Prepare data with proper formatting
            const excelData = guruData.map((guru, index) => ({
                'No': index + 1,
                'Nama Lengkap': guru.nama,
                'Kategori': guru.kategori || '-',
                'Tahun': guru.tahun || currentYear.toString(),
                'Status': guru.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                'Tanggal Daftar': guru.tanggalDaftar || '-'
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            const colWidths = [
                { wch: 5 },   // No
                { wch: 25 },  // Nama Lengkap
                { wch: 15 },  // Kategori
                { wch: 8 },   // Tahun
                { wch: 12 },  // Status
                { wch: 15 }   // Tanggal Daftar
            ];
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };
            }
            
            // Style data rows
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { horizontal: C === 0 ? "center" : "left", vertical: "center" },
                        border: {
                            top: { style: "thin", color: { rgb: "CCCCCC" } },
                            bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                            left: { style: "thin", color: { rgb: "CCCCCC" } },
                            right: { style: "thin", color: { rgb: "CCCCCC" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } }
                    };
                }
            }
            
            // Add title and organization info
            XLSX.utils.sheet_add_aoa(ws, [
                [`LAPORAN DATA GURU & SEPUH`],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Guru & Sepuh');
            XLSX.writeFile(wb, `data-guru-sepuh-${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Peserta Functions
        function handlePesertaSubmit(event) {
            event.preventDefault();
            
            const pesertaId = document.getElementById('pesertaId').value;
            const peserta = {
                id: pesertaId || Date.now().toString(),
                nama: document.getElementById('namaPeserta').value,
                jabatan: document.getElementById('jenisPeserta').value,
                telepon: document.getElementById('teleponPeserta').value,
                tahun: document.getElementById('tahunPeserta').value,
                status: document.getElementById('statusPembayaran').value,
                keterangan: document.getElementById('keteranganPeserta').value,
                tanggalDaftar: pesertaId ? 
                    pesertaData.find(p => p.id === pesertaId).tanggalDaftar : 
                    new Date().toISOString().split('T')[0]
            };
            
            if (pesertaId) {
                // Update existing
                const index = pesertaData.findIndex(p => p.id === pesertaId);
                pesertaData[index] = peserta;
            } else {
                // Add new
                pesertaData.push(peserta);
            }
            
            localStorage.setItem('pesertaData', JSON.stringify(pesertaData));
            loadPesertaTable();
            closeModal('pesertaModal');
            updateDashboard();
        }

        function loadPesertaTable() {
            const tbody = document.getElementById('pesertaTableBody');
            tbody.innerHTML = '';
            
            // Sort by position hierarchy
            const jabatanOrder = {
                'ketua': 1,
                'wakil': 2,
                'sekretaris': 3,
                'wakil-sekretaris': 4,
                'bendahara': 5,
                'wakil-bendahara': 6,
                'anggota': 7
            };
            
            const sortedPeserta = [...pesertaData].sort((a, b) => {
                const jabatanA = jabatanOrder[a.jabatan || a.jenis] || 999;
                const jabatanB = jabatanOrder[b.jabatan || b.jenis] || 999;
                return jabatanA - jabatanB;
            });
            
            sortedPeserta.forEach((peserta, index) => {
                const statusBadge = getStatusBadgePanitia(peserta.status);
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${peserta.nama}</td>
                        <td>${peserta.jabatan || peserta.jenis || '-'}</td>
                        <td>${peserta.telepon || '-'}</td>
                        <td>${peserta.tahun || '2024'}</td>
                        <td>${statusBadge}</td>
                        <td>${peserta.keterangan || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editPeserta('${peserta.id}')"></button>
                            <button class="btn-small btn-delete" onclick="deletePeserta('${peserta.id}')"></button>
                        </td>
                    </tr>
                `;
            });
        }

        function getStatusBadge(status) {
            const badges = {
                'belum': '<span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Belum Bayar</span>',
                'dp': '<span style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">DP</span>',
                'lunas': '<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Lunas</span>'
            };
            return badges[status] || badges['belum'];
        }

        function getStatusBadgePanitia(status) {
            const badges = {
                'aktif': '<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Aktif</span>',
                'tidak-aktif': '<span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Tidak Aktif</span>'
            };
            return badges[status] || badges['aktif'];
        }

        function editPeserta(id) {
            const peserta = pesertaData.find(p => p.id === id);
            if (peserta) {
                document.getElementById('pesertaId').value = peserta.id;
                document.getElementById('namaPeserta').value = peserta.nama;
                document.getElementById('jenisPeserta').value = peserta.jabatan || peserta.jenis || '';
                document.getElementById('teleponPeserta').value = peserta.telepon || '';
                document.getElementById('tahunPeserta').value = peserta.tahun || currentYear.toString();
                document.getElementById('statusPembayaran').value = peserta.status || peserta.statusPembayaran || 'aktif';
                document.getElementById('keteranganPeserta').value = peserta.keterangan || '';
                
                openModal('pesertaModal');
            }
        }

        function deletePeserta(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data panitia ini?')) {
                pesertaData = pesertaData.filter(p => p.id !== id);
                localStorage.setItem('pesertaData', JSON.stringify(pesertaData));
                loadPesertaTable();
                updateDashboard();
            }
        }

        function filterPeserta() {
            const searchTerm = document.getElementById('searchPeserta').value.toLowerCase();
            const jenisFilter = document.getElementById('filterJenisPeserta').value;
            const tahunFilter = document.getElementById('filterTahunPeserta').value;
            
            const rows = document.querySelectorAll('#pesertaTableBody tr');
            rows.forEach(row => {
                const nama = row.cells[1].textContent.toLowerCase();
                const jabatan = row.cells[2].textContent.toLowerCase();
                const tahun = row.cells[4].textContent;
                
                const matchSearch = nama.includes(searchTerm);
                const matchJabatan = !jenisFilter || jabatan === jenisFilter;
                const matchTahun = !tahunFilter || tahun === tahunFilter;
                
                row.style.display = matchSearch && matchJabatan && matchTahun ? '' : 'none';
            });
        }

        // Sapi Functions
        function generatePesertaSapiInputs() {
            const container = document.getElementById('pesertaSapiContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= 7; i++) {
                container.innerHTML += `
                    <div class="form-group">
                        <label>Peserta Bagian ${i}</label>
                        <input type="text" id="pesertaSapi${i}" placeholder="Nama peserta bagian ${i}">
                    </div>
                `;
            }
        }

        function handleSapiSubmit(event) {
            event.preventDefault();
            
            const sapiId = document.getElementById('sapiId').value;
            const jenisSapi = document.getElementById('jenisSapi').value;
            const peserta = [];
            
            // Collect peserta data
            for (let i = 1; i <= 7; i++) {
                const pesertaName = document.getElementById(`pesertaSapi${i}`).value;
                peserta.push(pesertaName);
            }
            
            // Check if jenis sapi already exists and is full (for new entries)
            if (!sapiId) {
                const existingSapi = sapiData.find(s => s.nama === jenisSapi);
                if (existingSapi) {
                    const pesertaTerisi = existingSapi.peserta ? existingSapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                    if (pesertaTerisi >= 7) {
                        alert(`${jenisSapi} sudah penuh! Pilih jenis sapi yang lain.`);
                        return;
                    }
                    // If not full, we'll update the existing entry
                    const index = sapiData.findIndex(s => s.id === existingSapi.id);
                    const sapi = {
                        ...existingSapi,
                        tahun: document.getElementById('tahunSapi').value,
                        keterangan: document.getElementById('keteranganSapi').value,
                        peserta: peserta
                    };
                    sapiData[index] = sapi;
                    localStorage.setItem('sapiData', JSON.stringify(sapiData));
                    loadSapiTable();
                    closeModal('sapiModal');
                    updateDashboard();
                    return;
                }
            }
            
            const sapi = {
                id: sapiId || Date.now().toString(),
                nama: jenisSapi,
                tahun: document.getElementById('tahunSapi').value,
                keterangan: document.getElementById('keteranganSapi').value,
                peserta: peserta,
                tanggalTambah: sapiId ? 
                    sapiData.find(s => s.id === sapiId).tanggalTambah : 
                    new Date().toISOString().split('T')[0]
            };
            
            if (sapiId) {
                // Update existing
                const index = sapiData.findIndex(s => s.id === sapiId);
                sapiData[index] = sapi;
            } else {
                // Add new
                sapiData.push(sapi);
            }
            
            localStorage.setItem('sapiData', JSON.stringify(sapiData));
            loadSapiTable();
            closeModal('sapiModal');
            updateDashboard();
        }

        function loadSapiTable() {
            const tbody = document.getElementById('sapiTableBody');
            tbody.innerHTML = '';
            
            // Update filter dropdown
            updateSapiFilter();
            
            sapiData.forEach((sapi, index) => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                const statusSapi = pesertaTerisi === 7 ? 'Penuh' : 'Tersedia';
                const statusColor = statusSapi === 'Penuh' ? '#ef4444' : '#10b981';
                
                const pesertaList = sapi.peserta ? sapi.peserta.map((p, i) => 
                    `${i + 1}. ${p || '-'}`
                ).join('<br>') : '-';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${sapi.nama}</td>
                        <td style="font-size: 12px;">${pesertaList}</td>
                        <td>${sapi.tahun || currentYear}</td>
                        <td><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${statusSapi} (${pesertaTerisi}/7)</span></td>
                        <td>${sapi.keterangan || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editSapi('${sapi.id}')"></button>
                            <button class="btn-small btn-delete" onclick="deleteSapi('${sapi.id}')"></button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateSapiFilter() {
            const filterSelect = document.getElementById('filterJenisSapi');
            if (!filterSelect) return;
            
            // Get unique cattle types
            const sapiTypes = new Set();
            sapiData.forEach(sapi => {
                if (sapi.nama) sapiTypes.add(sapi.nama);
            });
            
            // Clear and populate filter
            filterSelect.innerHTML = '<option value="">Semua Jenis Sapi</option>';
            Array.from(sapiTypes).sort().forEach(type => {
                filterSelect.innerHTML += `<option value="${type}">${type}</option>`;
            });
        }

        function populateSapiDropdown() {
            const sapiSelect = document.getElementById('jenisSapi');
            if (!sapiSelect) return;
            
            // Clear existing options except first
            sapiSelect.innerHTML = '<option value="">Pilih Jenis Sapi</option>';
            
            // Generate sapi options and check availability
            for (let i = 1; i <= 20; i++) {
                const sapiName = `Sapi ke-${i}`;
                const existingSapi = sapiData.find(s => s.nama === sapiName);
                
                if (!existingSapi) {
                    // Available - not yet created
                    sapiSelect.innerHTML += `<option value="${sapiName}">${sapiName} (Tersedia)</option>`;
                } else {
                    // Check if full
                    const pesertaTerisi = existingSapi.peserta ? existingSapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                    if (pesertaTerisi < 7) {
                        // Not full - can be selected
                        sapiSelect.innerHTML += `<option value="${sapiName}">${sapiName} (${pesertaTerisi}/7)</option>`;
                    } else {
                        // Full - disabled
                        sapiSelect.innerHTML += `<option value="${sapiName}" disabled>${sapiName} (Penuh)</option>`;
                    }
                }
            }
        }

        function editSapi(id) {
            const sapi = sapiData.find(s => s.id === id);
            if (sapi) {
                document.getElementById('sapiId').value = sapi.id;
                
                // Generate inputs first
                generatePesertaSapiInputs();
                
                // Populate dropdown and set selected value
                populateSapiDropdown();
                document.getElementById('jenisSapi').value = sapi.nama || '';
                
                document.getElementById('tahunSapi').value = sapi.tahun || currentYear.toString();
                document.getElementById('keteranganSapi').value = sapi.keterangan || '';
                
                // Then fill the peserta data
                if (sapi.peserta) {
                    sapi.peserta.forEach((peserta, index) => {
                        const input = document.getElementById(`pesertaSapi${index + 1}`);
                        if (input) {
                            input.value = peserta || '';
                        }
                    });
                }
                
                openModal('sapiModal');
            }
        }

        function deleteSapi(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data sapi ini?')) {
                sapiData = sapiData.filter(s => s.id !== id);
                localStorage.setItem('sapiData', JSON.stringify(sapiData));
                loadSapiTable();
                updateDashboard();
            }
        }

        function filterSapi() {
            const jenisFilter = document.getElementById('filterJenisSapi').value;
            const statusFilter = document.getElementById('filterStatusSapi').value;
            const tahunFilter = document.getElementById('filterTahunSapi').value;
            
            const rows = document.querySelectorAll('#sapiTableBody tr');
            rows.forEach(row => {
                const nama = row.cells[0].textContent.toLowerCase();
                const tahun = row.cells[2].textContent;
                const status = row.cells[3].textContent.toLowerCase();
                
                const matchJenis = !jenisFilter || nama.includes(jenisFilter.toLowerCase());
                const matchStatus = !statusFilter || status.includes(statusFilter);
                const matchTahun = !tahunFilter || tahun === tahunFilter;
                
                row.style.display = matchJenis && matchStatus && matchTahun ? '' : 'none';
            });
        }

        // Kambing Functions
        function handleKambingSubmit(event) {
            event.preventDefault();
            
            const kambingId = document.getElementById('kambingId').value;
            const kambing = {
                id: kambingId || Date.now().toString(),
                jenis: document.getElementById('jenisKambing').value,
                peserta: document.getElementById('pesertaKambing').value,
                tahun: document.getElementById('tahunKambing').value,
                keterangan: document.getElementById('keteranganKambing').value,
                tanggalTambah: kambingId ? 
                    kambingData.find(k => k.id === kambingId).tanggalTambah : 
                    new Date().toISOString().split('T')[0]
            };
            
            if (kambingId) {
                // Update existing
                const index = kambingData.findIndex(k => k.id === kambingId);
                kambingData[index] = kambing;
            } else {
                // Add new
                kambingData.push(kambing);
            }
            
            localStorage.setItem('kambingData', JSON.stringify(kambingData));
            loadKambingTable();
            closeModal('kambingModal');
            updateDashboard();
        }

        function loadKambingTable() {
            const tbody = document.getElementById('kambingTableBody');
            tbody.innerHTML = '';
            
            kambingData.forEach((kambing, index) => {
                const statusKambing = kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia';
                const statusColor = statusKambing === 'Terisi' ? '#ef4444' : '#10b981';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${kambing.jenis || kambing.nama || '-'}</td>
                        <td>${kambing.peserta || '-'}</td>
                        <td>${kambing.tahun || '2024'}</td>
                        <td><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${statusKambing}</span></td>
                        <td>${kambing.keterangan || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editKambing('${kambing.id}')"></button>
                            <button class="btn-small btn-delete" onclick="deleteKambing('${kambing.id}')"></button>
                        </td>
                    </tr>
                `;
            });
        }

        function editKambing(id) {
            const kambing = kambingData.find(k => k.id === id);
            if (kambing) {
                document.getElementById('kambingId').value = kambing.id;
                document.getElementById('jenisKambing').value = kambing.jenis || kambing.nama || '';
                document.getElementById('pesertaKambing').value = kambing.peserta || '';
                document.getElementById('tahunKambing').value = kambing.tahun || currentYear.toString();
                document.getElementById('keteranganKambing').value = kambing.keterangan || '';
                
                openModal('kambingModal');
            }
        }

        function deleteKambing(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data kambing ini?')) {
                kambingData = kambingData.filter(k => k.id !== id);
                localStorage.setItem('kambingData', JSON.stringify(kambingData));
                loadKambingTable();
                updateDashboard();
            }
        }

        function filterKambing() {
            const searchTerm = document.getElementById('searchKambing').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatusKambing').value;
            const tahunFilter = document.getElementById('filterTahunKambing').value;
            
            const rows = document.querySelectorAll('#kambingTableBody tr');
            rows.forEach(row => {
                const nama = row.cells[1].textContent.toLowerCase();
                const peserta = row.cells[2].textContent.toLowerCase();
                const tahun = row.cells[3].textContent;
                const status = row.cells[4].textContent.toLowerCase();
                
                const matchSearch = nama.includes(searchTerm) || peserta.includes(searchTerm);
                const matchStatus = !statusFilter || status.includes(statusFilter);
                const matchTahun = !tahunFilter || tahun === tahunFilter;
                
                row.style.display = matchSearch && matchStatus && matchTahun ? '' : 'none';
            });
        }

        // Mustahik Functions

        function handlePembagianSubmit(event) {
            event.preventDefault();
            
            const mustahikId = document.getElementById('mustahikId').value;
            const mustahik = {
                id: mustahikId || Date.now().toString(),
                nama: document.getElementById('namaMustahik').value,
                rt: document.getElementById('rtMustahik').value,
                tahun: document.getElementById('tahunMustahik').value,
                status: document.getElementById('statusMustahik').value,
                tanggalDaftar: mustahikId ? 
                    mustahikData.find(m => m.id === mustahikId).tanggalDaftar : 
                    new Date().toISOString().split('T')[0]
            };
            
            if (mustahikId) {
                // Update existing
                const index = mustahikData.findIndex(m => m.id === mustahikId);
                mustahikData[index] = mustahik;
            } else {
                // Add new
                mustahikData.push(mustahik);
            }
            
            localStorage.setItem('mustahikData', JSON.stringify(mustahikData));
            loadPembagianTable();
            closeModal('pembagianModal');
            updateDashboard();
        }

        function loadPembagianTable() {
            const tbody = document.getElementById('pembagianTableBody');
            tbody.innerHTML = '';
            
            mustahikData.forEach((mustahik, index) => {
                const statusColor = mustahik.status === 'aktif' ? '#10b981' : '#ef4444';
                const statusText = mustahik.status === 'aktif' ? 'Aktif' : 'Tidak Aktif';
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${mustahik.nama}</td>
                        <td>${mustahik.rt}</td>
                        <td>${mustahik.tahun || '2024'}</td>
                        <td><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${statusText}</span></td>
                        <td class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editMustahik('${mustahik.id}')"></button>
                            <button class="btn-small btn-delete" onclick="deleteMustahik('${mustahik.id}')"></button>
                        </td>
                    </tr>
                `;
            });
        }

        function editMustahik(id) {
            const mustahik = mustahikData.find(m => m.id === id);
            if (mustahik) {
                document.getElementById('mustahikId').value = mustahik.id;
                document.getElementById('namaMustahik').value = mustahik.nama;
                document.getElementById('rtMustahik').value = mustahik.rt;
                document.getElementById('tahunMustahik').value = mustahik.tahun || currentYear.toString();
                document.getElementById('statusMustahik').value = mustahik.status;
                
                openModal('pembagianModal');
            }
        }

        function deleteMustahik(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data mustahik ini?')) {
                mustahikData = mustahikData.filter(m => m.id !== id);
                localStorage.setItem('mustahikData', JSON.stringify(mustahikData));
                loadPembagianTable();
                updateDashboard();
            }
        }

        function populateMustahikFilters() {
            // Populate RT filter with predefined options
            const rtOptions = ['RT10/04', 'RT03/04', 'RT04/04', 'RT02/03', 'RT03/03'];
            
            const rtFilter = document.getElementById('filterRTMustahik');
            
            // Clear existing options except first
            rtFilter.innerHTML = '<option value="">Semua RT</option>';
            
            // Add predefined RT options
            rtOptions.forEach(rt => {
                rtFilter.innerHTML += `<option value="${rt}">${rt}</option>`;
            });
        }

        function filterMustahik() {
            const searchTerm = document.getElementById('searchMustahik').value.toLowerCase();
            const rtFilter = document.getElementById('filterRTMustahik').value;
            const statusFilter = document.getElementById('filterStatusMustahik').value;
            const tahunFilter = document.getElementById('filterTahunMustahik').value;
            
            const rows = document.querySelectorAll('#pembagianTableBody tr');
            rows.forEach(row => {
                const nama = row.cells[1].textContent.toLowerCase();
                const rt = row.cells[2].textContent;
                const tahun = row.cells[3].textContent;
                const status = row.cells[4].textContent.toLowerCase();
                
                const matchSearch = nama.includes(searchTerm);
                const matchRT = !rtFilter || rt === rtFilter;
                const matchTahun = !tahunFilter || tahun === tahunFilter;
                const matchStatus = !statusFilter || status.includes(statusFilter);
                
                row.style.display = matchSearch && matchRT && matchTahun && matchStatus ? '' : 'none';
            });
        }

        // Export Functions
        function exportPesertaPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Sort data by position hierarchy
            const jabatanOrder = {
                'ketua': 1,
                'wakil': 2,
                'sekretaris': 3,
                'wakil-sekretaris': 4,
                'bendahara': 5,
                'wakil-bendahara': 6,
                'anggota': 7
            };
            
            const sortedPeserta = [...pesertaData].sort((a, b) => {
                const jabatanA = jabatanOrder[a.jabatan || a.jenis] || 999;
                const jabatanB = jabatanOrder[b.jabatan || b.jenis] || 999;
                return jabatanA - jabatanB;
            });
            
            // Add logo if available
            let startY = 20;
            if (pengaturanData.logoBase64) {
                try {
                    doc.addImage(pengaturanData.logoBase64, 'JPEG', 20, 10, 20, 20);
                } catch (e) {
                    console.log('Logo could not be added to PDF');
                }
            }
            
            // Header
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('LAPORAN DATA PANITIA', 105, startY, { align: 'center' });
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text(`${pengaturanData.namaOrganisasi}`, 105, startY + 10, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`${pengaturanData.alamatOrganisasi}`, 105, startY + 18, { align: 'center' });
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 105, startY + 26, { align: 'center' });
            
            // Line separator
            doc.setLineWidth(1);
            doc.line(20, startY + 32, 190, startY + 32);
            doc.setLineWidth(0.5);
            doc.line(20, startY + 34, 190, startY + 34);
            
            // Summary statistics
            const totalPanitia = pesertaData.length;
            const panitiaAktif = pesertaData.filter(p => p.status === 'aktif').length;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text(`Total Panitia: ${totalPanitia} orang | Aktif: ${panitiaAktif} orang | Tidak Aktif: ${totalPanitia - panitiaAktif} orang`, 20, startY + 42);
            
            // Prepare table data with sorted order
            const tableData = sortedPeserta.map((peserta, index) => [
                index + 1,
                peserta.nama,
                peserta.jabatan || peserta.jenis || '-',
                peserta.telepon || '-',
                peserta.tahun || currentYear.toString(),
                peserta.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                peserta.keterangan || '-'
            ]);
            
            // Add table with professional styling
            doc.autoTable({
                head: [['No', 'Nama Lengkap', 'Jabatan', 'No. HP', 'Tahun', 'Status', 'Keterangan']],
                body: tableData,
                startY: startY + 50,
                styles: { 
                    fontSize: 8,
                    cellPadding: 4,
                    halign: 'left',
                    valign: 'middle',
                    lineColor: [0, 0, 0],
                    lineWidth: 0.1
                },
                headStyles: {
                    fillColor: [30, 95, 61],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    halign: 'center',
                    fontSize: 9,
                    cellPadding: 5,
                    lineColor: [255, 255, 255],
                    lineWidth: 0.5
                },
                alternateRowStyles: {
                    fillColor: [248, 249, 250]
                },
                rowStyles: {
                    lineColor: [222, 226, 230],
                    lineWidth: 0.1
                },
                margin: { left: 15, right: 15 },
                columnStyles: {
                    0: { halign: 'center', cellWidth: 12 },
                    1: { cellWidth: 40, fontStyle: 'bold' },
                    2: { cellWidth: 25, halign: 'center' },
                    3: { cellWidth: 25, halign: 'center' },
                    4: { halign: 'center', cellWidth: 15 },
                    5: { halign: 'center', cellWidth: 20 },
                    6: { cellWidth: 35 }
                },
                tableLineColor: [30, 95, 61],
                tableLineWidth: 0.5
            });
            
            // Footer
            const finalY = doc.lastAutoTable.finalY + 15;
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text(`Dicetak pada: ${new Date().toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            })}`, 20, finalY);
            doc.text(`Sistem Manajemen Qurban - ${pengaturanData.namaOrganisasi}`, 20, finalY + 8);
            
            // Page number
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Halaman ${i} dari ${pageCount}`, 190, 285, { align: 'right' });
            }
            
            doc.save(`laporan-panitia-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function exportPesertaExcel() {
            // Sort data by position hierarchy
            const jabatanOrder = {
                'ketua': 1,
                'wakil': 2,
                'sekretaris': 3,
                'wakil-sekretaris': 4,
                'bendahara': 5,
                'wakil-bendahara': 6,
                'anggota': 7
            };
            
            const sortedPeserta = [...pesertaData].sort((a, b) => {
                const jabatanA = jabatanOrder[a.jabatan || a.jenis] || 999;
                const jabatanB = jabatanOrder[b.jabatan || b.jenis] || 999;
                return jabatanA - jabatanB;
            });
            
            // Prepare data with proper formatting and sorted order
            const excelData = sortedPeserta.map((peserta, index) => ({
                'No': index + 1,
                'Nama Lengkap': peserta.nama,
                'Jabatan': peserta.jabatan || peserta.jenis || '-',
                'No. HP': peserta.telepon || '-',
                'Tahun': peserta.tahun || currentYear.toString(),
                'Status': peserta.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                'Keterangan': peserta.keterangan || '-',
                'Tanggal Daftar': peserta.tanggalDaftar || '-'
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            const colWidths = [
                { wch: 5 },   // No
                { wch: 25 },  // Nama Lengkap
                { wch: 18 },  // Jabatan
                { wch: 15 },  // No. HP
                { wch: 8 },   // Tahun
                { wch: 12 },  // Status
                { wch: 30 },  // Keterangan
                { wch: 15 }   // Tanggal Daftar
            ];
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row with professional borders
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" }, size: 12 },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thick", color: { rgb: "1E5F3D" } },
                        bottom: { style: "thick", color: { rgb: "1E5F3D" } },
                        left: { style: "thick", color: { rgb: "1E5F3D" } },
                        right: { style: "thick", color: { rgb: "1E5F3D" } }
                    }
                };
            }
            
            // Style data rows with professional borders
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { 
                            horizontal: C === 0 ? "center" : (C === 2 || C === 4 || C === 5) ? "center" : "left", 
                            vertical: "center" 
                        },
                        border: {
                            top: { style: "thin", color: { rgb: "DEE2E6" } },
                            bottom: { style: "thin", color: { rgb: "DEE2E6" } },
                            left: { style: "thin", color: { rgb: "DEE2E6" } },
                            right: { style: "thin", color: { rgb: "DEE2E6" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } },
                        font: { 
                            bold: C === 1 ? true : false,
                            size: 10
                        }
                    };
                }
            }
            
            // Add title and organization info with professional styling
            XLSX.utils.sheet_add_aoa(ws, [
                [`LAPORAN DATA PANITIA`],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            // Style title rows
            const titleRange = XLSX.utils.decode_range(ws['!ref']);
            for (let R = 0; R < 5; R++) {
                const address = XLSX.utils.encode_cell({ r: R, c: 0 });
                if (ws[address]) {
                    ws[address].s = {
                        font: { 
                            bold: R === 0 ? true : false, 
                            size: R === 0 ? 16 : 12,
                            color: { rgb: "1E5F3D" }
                        },
                        alignment: { horizontal: "center", vertical: "center" }
                    };
                }
            }
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Panitia');
            XLSX.writeFile(wb, `laporan-panitia-${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportSapiPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Laporan Data Sapi Qurban', 20, 20);
            doc.setFontSize(12);
            doc.text(`${pengaturanData.namaOrganisasi}`, 20, 30);
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 20, 40);
            
            const tableData = sapiData.map((sapi, index) => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                const pesertaList = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').join(', ') : '-';
                return [
                    index + 1,
                    sapi.nama,
                    sapi.berat + ' kg',
                    'Rp ' + sapi.harga.toLocaleString('id-ID'),
                    `${pesertaTerisi}/7`,
                    pesertaList
                ];
            });
            
            doc.autoTable({
                head: [['No', 'Nama Sapi', 'Berat', 'Harga', 'Status', 'Peserta']],
                body: tableData,
                startY: 50,
                styles: { fontSize: 7 }
            });
            
            doc.save('laporan-sapi-qurban.pdf');
        }

        function exportSapiExcel() {
            // Prepare data with proper formatting
            const excelData = sapiData.map((sapi, index) => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                return {
                    'No': index + 1,
                    'Nama Sapi': sapi.nama,
                    'Tahun': sapi.tahun || currentYear.toString(),
                    'Status': `${pesertaTerisi}/7 ${pesertaTerisi >= 7 ? '(Penuh)' : '(Tersedia)'}`,
                    'Peserta 1': sapi.peserta ? sapi.peserta[0] || '-' : '-',
                    'Peserta 2': sapi.peserta ? sapi.peserta[1] || '-' : '-',
                    'Peserta 3': sapi.peserta ? sapi.peserta[2] || '-' : '-',
                    'Peserta 4': sapi.peserta ? sapi.peserta[3] || '-' : '-',
                    'Peserta 5': sapi.peserta ? sapi.peserta[4] || '-' : '-',
                    'Peserta 6': sapi.peserta ? sapi.peserta[5] || '-' : '-',
                    'Peserta 7': sapi.peserta ? sapi.peserta[6] || '-' : '-',
                    'Keterangan': sapi.keterangan || '-',
                    'Tanggal Tambah': sapi.tanggalTambah || '-'
                };
            });

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            const colWidths = [
                { wch: 5 },   // No
                { wch: 15 },  // Nama Sapi
                { wch: 8 },   // Tahun
                { wch: 15 },  // Status
                { wch: 20 },  // Peserta 1
                { wch: 20 },  // Peserta 2
                { wch: 20 },  // Peserta 3
                { wch: 20 },  // Peserta 4
                { wch: 20 },  // Peserta 5
                { wch: 20 },  // Peserta 6
                { wch: 20 },  // Peserta 7
                { wch: 25 },  // Keterangan
                { wch: 15 }   // Tanggal Tambah
            ];
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };
            }
            
            // Style data rows
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { horizontal: C === 0 ? "center" : "left", vertical: "center" },
                        border: {
                            top: { style: "thin", color: { rgb: "CCCCCC" } },
                            bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                            left: { style: "thin", color: { rgb: "CCCCCC" } },
                            right: { style: "thin", color: { rgb: "CCCCCC" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } }
                    };
                }
            }
            
            // Add title and organization info
            XLSX.utils.sheet_add_aoa(ws, [
                [`LAPORAN DATA QURBAN SAPI`],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Sapi');
            XLSX.writeFile(wb, `data-sapi-qurban-${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportKambingPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Laporan Data Kambing Qurban', 20, 20);
            doc.setFontSize(12);
            doc.text(`${pengaturanData.namaOrganisasi}`, 20, 30);
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 20, 40);
            
            const tableData = kambingData.map((kambing, index) => [
                index + 1,
                kambing.nama,
                kambing.berat + ' kg',
                'Rp ' + kambing.harga.toLocaleString('id-ID'),
                kambing.peserta || '-',
                kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia'
            ]);
            
            doc.autoTable({
                head: [['No', 'Nama Kambing', 'Berat', 'Harga', 'Peserta', 'Status']],
                body: tableData,
                startY: 50,
                styles: { fontSize: 8 }
            });
            
            doc.save('laporan-kambing-qurban.pdf');
        }

        function exportKambingExcel() {
            // Prepare data with proper formatting
            const excelData = kambingData.map((kambing, index) => ({
                'No': index + 1,
                'Jenis Hewan': kambing.jenis || kambing.nama || 'Kambing',
                'Peserta': kambing.peserta || '-',
                'Tahun': kambing.tahun || currentYear.toString(),
                'Status': kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia',
                'Keterangan': kambing.keterangan || '-',
                'Tanggal Tambah': kambing.tanggalTambah || '-'
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            const colWidths = [
                { wch: 5 },   // No
                { wch: 15 },  // Jenis Hewan
                { wch: 25 },  // Peserta
                { wch: 8 },   // Tahun
                { wch: 12 },  // Status
                { wch: 30 },  // Keterangan
                { wch: 15 }   // Tanggal Tambah
            ];
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };
            }
            
            // Style data rows
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { horizontal: C === 0 ? "center" : "left", vertical: "center" },
                        border: {
                            top: { style: "thin", color: { rgb: "CCCCCC" } },
                            bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                            left: { style: "thin", color: { rgb: "CCCCCC" } },
                            right: { style: "thin", color: { rgb: "CCCCCC" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } }
                    };
                }
            }
            
            // Add title and organization info
            XLSX.utils.sheet_add_aoa(ws, [
                [`LAPORAN DATA QURBAN KAMBING`],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Kambing');
            XLSX.writeFile(wb, `data-kambing-qurban-${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function exportPembagianPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Laporan Data Mustahik', 20, 20);
            doc.setFontSize(12);
            doc.text(`${pengaturanData.namaOrganisasi}`, 20, 30);
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 20, 40);
            
            const tableData = mustahikData.map((mustahik, index) => [
                index + 1,
                mustahik.nama,
                mustahik.rt,
                mustahik.rw,
                mustahik.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'
            ]);
            
            doc.autoTable({
                head: [['No', 'Nama Mustahik', 'RT', 'RW', 'Status']],
                body: tableData,
                startY: 50,
                styles: { fontSize: 8 }
            });
            
            doc.save('laporan-mustahik.pdf');
        }

        function exportPembagianExcel() {
            // Prepare data with proper formatting
            const excelData = mustahikData.map((mustahik, index) => ({
                'No': index + 1,
                'Nama Mustahik': mustahik.nama,
                'RT': mustahik.rt,
                'Tahun': mustahik.tahun || currentYear.toString(),
                'Status': mustahik.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                'Tanggal Daftar': mustahik.tanggalDaftar || '-'
            }));

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            const colWidths = [
                { wch: 5 },   // No
                { wch: 25 },  // Nama Mustahik
                { wch: 12 },  // RT
                { wch: 8 },   // Tahun
                { wch: 12 },  // Status
                { wch: 15 }   // Tanggal Daftar
            ];
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };
            }
            
            // Style data rows
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { horizontal: C === 0 ? "center" : "left", vertical: "center" },
                        border: {
                            top: { style: "thin", color: { rgb: "CCCCCC" } },
                            bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                            left: { style: "thin", color: { rgb: "CCCCCC" } },
                            right: { style: "thin", color: { rgb: "CCCCCC" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } }
                    };
                }
            }
            
            // Add title and organization info
            XLSX.utils.sheet_add_aoa(ws, [
                [`LAPORAN DATA MUSTAHIK`],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Mustahik');
            XLSX.writeFile(wb, `data-mustahik-${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Laporan Functions
        function generateLaporan() {
            const jenisLaporan = document.getElementById('jenisLaporan').value;
            const tahunLaporan = document.getElementById('tahunLaporan').value;
            const laporanContent = document.getElementById('laporanContent');
            const rtFilterGroup = document.getElementById('rtFilterGroup');
            
            // Show/hide RT filter based on report type
            if (jenisLaporan === 'mustahik' || jenisLaporan === 'mustahik-per-rt') {
                rtFilterGroup.style.display = 'block';
            } else {
                rtFilterGroup.style.display = 'none';
            }
            
            if (!jenisLaporan || !tahunLaporan) {
                laporanContent.innerHTML = '<div style="text-align: center; padding: 50px; color: #6b7280;">Pilih jenis laporan dan tahun untuk menampilkan data</div>';
                return;
            }
            
            let content = '';
            
            switch (jenisLaporan) {
                case 'panitia':
                    content = generateLaporanPanitia(tahunLaporan);
                    break;
                case 'guru':
                    content = generateLaporanGuru(tahunLaporan);
                    break;
                case 'mustahik':
                    content = generateLaporanMustahik(tahunLaporan);
                    break;
                case 'mustahik-per-rt':
                    content = generateLaporanMustahikPerRT(tahunLaporan);
                    break;
                case 'peserta-semua':
                    content = generateLaporanPesertaSemua(tahunLaporan);
                    break;
                case 'peserta-sapi':
                    content = generateLaporanPesertaSapi(tahunLaporan);
                    break;
                case 'peserta-kambing':
                    content = generateLaporanPesertaKambing(tahunLaporan);
                    break;
                case 'hewan-semua':
                    content = generateLaporanHewanSemua(tahunLaporan);
                    break;
                case 'hewan-sapi':
                    content = generateLaporanHewanSapi(tahunLaporan);
                    break;
                case 'hewan-kambing':
                    content = generateLaporanHewanKambing(tahunLaporan);
                    break;
            }
            
            laporanContent.innerHTML = content;
        }

        function generateLaporanGuru(tahun) {
            // Filter data by year
            const filteredGuru = guruData.filter(g => (g.tahun || currentYear.toString()) === tahun);
            
            const totalGuru = filteredGuru.length;
            const guruAktif = filteredGuru.filter(g => g.status === 'aktif').length;
            const guruTidakAktif = filteredGuru.filter(g => g.status === 'tidak-aktif').length;
            
            // Count by category
            const guruCount = filteredGuru.filter(g => g.kategori === 'guru').length;
            const sepuhCount = filteredGuru.filter(g => g.kategori === 'sepuh').length;
            const ustadzCount = filteredGuru.filter(g => g.kategori === 'ustadz').length;
            const kyaiCount = filteredGuru.filter(g => g.kategori === 'kyai').length;
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px; text-align: center; font-size: 20px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;"> Laporan Data Guru & Sepuh Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalGuru}</div>
                            <div style="color: #6b7280; font-weight: 600;">Total Guru & Sepuh</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${guruAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Aktif</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${guruTidakAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Tidak Aktif</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 16px; font-weight: bold; color: #f59e0b;">Guru: ${guruCount} | Sepuh: ${sepuhCount}</div>
                            <div style="color: #6b7280; font-weight: 600;">Ustadz: ${ustadzCount} | Kyai: ${kyaiCount}</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #1e5f3d; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 100%); color: white;">
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">No</th>
                                <th style="padding: 15px 12px; text-align: left; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Nama Lengkap</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Kategori</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredGuru.map((guru, index) => `
                                <tr style="background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">${index + 1}</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: 500;">${guru.nama}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 500; text-transform: capitalize;">${guru.kategori || '-'}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">${getStatusBadgePanitia(guru.status || 'aktif')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanPanitia(tahun) {
            // Filter data by year
            const filteredPanitia = pesertaData.filter(p => (p.tahun || currentYear.toString()) === tahun);
            
            // Sort by position hierarchy
            const jabatanOrder = {
                'ketua': 1,
                'wakil': 2,
                'sekretaris': 3,
                'wakil-sekretaris': 4,
                'bendahara': 5,
                'wakil-bendahara': 6,
                'anggota': 7
            };
            
            const sortedPanitia = [...filteredPanitia].sort((a, b) => {
                const jabatanA = jabatanOrder[a.jabatan || a.jenis] || 999;
                const jabatanB = jabatanOrder[b.jabatan || b.jenis] || 999;
                return jabatanA - jabatanB;
            });
            
            const totalPanitia = filteredPanitia.length;
            const panitiaAktif = filteredPanitia.filter(p => p.status === 'aktif').length;
            const panitiaTidakAktif = filteredPanitia.filter(p => p.status === 'tidak-aktif').length;
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px; text-align: center; font-size: 20px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;"> Laporan Data Panitia Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalPanitia}</div>
                            <div style="color: #6b7280; font-weight: 600;">Total Panitia</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${panitiaAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Panitia Aktif</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${panitiaTidakAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Panitia Tidak Aktif</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #1e5f3d; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 100%); color: white;">
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">No</th>
                                <th style="padding: 15px 12px; text-align: left; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Nama Lengkap</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Jabatan</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">No. HP</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedPanitia.map((panitia, index) => `
                                <tr style="background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">${index + 1}</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: 500;">${panitia.nama}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 500; text-transform: capitalize;">${panitia.jabatan || panitia.jenis || '-'}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">${panitia.telepon || '-'}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">${getStatusBadgePanitia(panitia.status || 'aktif')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanMustahikPerRT(tahun) {
            // Filter data by year first
            const filteredMustahik = mustahikData.filter(m => (m.tahun || currentYear.toString()) === tahun);
            
            // Group mustahik by RT
            const mustahikByRT = {};
            filteredMustahik.forEach(mustahik => {
                const rt = mustahik.rt || 'Tidak Diketahui';
                if (!mustahikByRT[rt]) {
                    mustahikByRT[rt] = [];
                }
                mustahikByRT[rt].push(mustahik);
            });
            
            const totalMustahik = filteredMustahik.length;
            const totalRT = Object.keys(mustahikByRT).length;
            
            let rtTables = '';
            Object.keys(mustahikByRT).sort().forEach(rt => {
                const mustahikRT = mustahikByRT[rt];
                rtTables += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #1e5f3d; margin-bottom: 15px;">${rt} (${mustahikRT.length} Mustahik)</h4>
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: #2d8659; color: white;">
                                    <th style="padding: 10px; text-align: left;">No</th>
                                    <th style="padding: 10px; text-align: left;">Nama Mustahik</th>
                                    <th style="padding: 10px; text-align: left;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${mustahikRT.map((mustahik, index) => `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 10px;">${index + 1}</td>
                                        <td style="padding: 10px;">${mustahik.nama}</td>
                                        <td style="padding: 10px;">${getStatusBadgePanitia(mustahik.status || 'aktif')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            });
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Data Mustahik Per RT Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalMustahik}</div>
                            <div style="color: #6b7280;">Total Mustahik</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${totalRT}</div>
                            <div style="color: #6b7280;">Total RT</div>
                        </div>
                    </div>
                    ${rtTables}
                </div>
            `;
        }

        function generateLaporanMustahik(tahun) {
            const rtFilter = document.getElementById('rtLaporanFilter') ? document.getElementById('rtLaporanFilter').value : '';
            
            // Filter data by year first
            let filteredMustahik = mustahikData.filter(m => (m.tahun || currentYear.toString()) === tahun);
            
            // Then filter by RT if selected
            if (rtFilter) {
                filteredMustahik = filteredMustahik.filter(m => m.rt === rtFilter);
            }
            
            const totalMustahik = filteredMustahik.length;
            const mustahikAktif = filteredMustahik.filter(m => m.status === 'aktif').length;
            const mustahikTidakAktif = filteredMustahik.filter(m => m.status === 'tidak-aktif').length;
            
            const titleSuffix = rtFilter ? ` - ${rtFilter}` : '';
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px; text-align: center; font-size: 20px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;"> Laporan Data Mustahik Tahun ${tahun}${titleSuffix}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalMustahik}</div>
                            <div style="color: #6b7280; font-weight: 600;">Total Mustahik</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${mustahikAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Mustahik Aktif</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${mustahikTidakAktif}</div>
                            <div style="color: #6b7280; font-weight: 600;">Mustahik Tidak Aktif</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border: 2px solid #1e5f3d; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #1e5f3d 0%, #2d8659 100%); color: white;">
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">No</th>
                                <th style="padding: 15px 12px; text-align: left; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Nama Mustahik</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">RT</th>
                                <th style="padding: 15px 12px; text-align: center; border: 1px solid #fff; font-weight: bold; font-size: 14px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredMustahik.map((mustahik, index) => `
                                <tr style="background: ${index % 2 === 0 ? '#f8f9fa' : 'white'}; border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">${index + 1}</td>
                                    <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: 500;">${mustahik.nama}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6; font-weight: 500;">${mustahik.rt}</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">${getStatusBadgePanitia(mustahik.status || 'aktif')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanPesertaSemua(tahun) {
            // Filter data by year first
            const filteredSapi = sapiData.filter(s => (s.tahun || currentYear.toString()) === tahun);
            const filteredKambing = kambingData.filter(k => (k.tahun || currentYear.toString()) === tahun);
            
            // Gabungkan peserta dari sapi dan kambing
            const pesertaSapi = filteredSapi.reduce((acc, sapi) => {
                if (sapi.peserta) {
                    sapi.peserta.forEach((nama, index) => {
                        if (nama && nama.trim() !== '') {
                            acc.push({
                                nama: nama,
                                jenis: 'Sapi',
                                namaHewan: sapi.nama
                            });
                        }
                    });
                }
                return acc;
            }, []);
            
            const pesertaKambing = filteredKambing.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '').map(kambing => ({
                nama: kambing.peserta,
                jenis: kambing.jenis || 'Kambing',
                namaHewan: kambing.jenis || 'Kambing'
            }));
            
            const semuaPeserta = [...pesertaSapi, ...pesertaKambing];
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Data Seluruh Peserta Qurban Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${semuaPeserta.length}</div>
                            <div style="color: #6b7280;">Total Peserta Qurban</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${pesertaSapi.length}</div>
                            <div style="color: #6b7280;">Peserta Sapi</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${pesertaKambing.length}</div>
                            <div style="color: #6b7280;">Peserta Kambing</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Nama Peserta</th>
                                <th style="padding: 12px; text-align: left;">Jenis Hewan</th>
                                <th style="padding: 12px; text-align: left;">Nama Hewan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${semuaPeserta.map((peserta, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px;">${index + 1}</td>
                                    <td style="padding: 12px;">${peserta.nama}</td>
                                    <td style="padding: 12px;">${peserta.jenis}</td>
                                    <td style="padding: 12px;">${peserta.namaHewan}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanPesertaSapi(tahun) {
            // Filter data by year first
            const filteredSapi = sapiData.filter(s => (s.tahun || currentYear.toString()) === tahun);
            
            const pesertaSapi = filteredSapi.reduce((acc, sapi) => {
                if (sapi.peserta) {
                    sapi.peserta.forEach((nama, index) => {
                        if (nama && nama.trim() !== '') {
                            acc.push({
                                nama: nama,
                                bagian: index + 1,
                                namaHewan: sapi.nama,
                                keterangan: sapi.keterangan || '-'
                            });
                        }
                    });
                }
                return acc;
            }, []);
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Data Peserta Qurban Sapi Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${pesertaSapi.length}</div>
                            <div style="color: #6b7280;">Total Peserta Sapi</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${filteredSapi.length}</div>
                            <div style="color: #6b7280;">Total Sapi</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Nama Pequrban</th>
                                <th style="padding: 12px; text-align: left;">Nama Sapi</th>
                                <th style="padding: 12px; text-align: left;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pesertaSapi.map((peserta, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px;">${index + 1}</td>
                                    <td style="padding: 12px;">${peserta.nama}</td>
                                    <td style="padding: 12px;">${peserta.namaHewan}</td>
                                    <td style="padding: 12px;">${peserta.keterangan}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanPesertaKambing(tahun) {
            // Filter data by year first
            const filteredKambing = kambingData.filter(k => (k.tahun || currentYear.toString()) === tahun);
            const pesertaKambing = filteredKambing.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '');
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Data Peserta Qurban Kambing Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${pesertaKambing.length}</div>
                            <div style="color: #6b7280;">Total Peserta Kambing</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${filteredKambing.length}</div>
                            <div style="color: #6b7280;">Total Kambing</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Nama Pequrban</th>
                                <th style="padding: 12px; text-align: left;">Jenis Hewan</th>
                                <th style="padding: 12px; text-align: left;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pesertaKambing.map((kambing, index) => `
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px;">${index + 1}</td>
                                    <td style="padding: 12px;">${kambing.peserta}</td>
                                    <td style="padding: 12px;">${kambing.jenis || 'Kambing'}</td>
                                    <td style="padding: 12px;">${kambing.keterangan || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanHewanSemua(tahun) {
            // Filter data by year first
            const filteredSapi = sapiData.filter(s => (s.tahun || currentYear.toString()) === tahun);
            const filteredKambing = kambingData.filter(k => (k.tahun || currentYear.toString()) === tahun);
            
            const totalHewan = filteredSapi.length + filteredKambing.length;
            const totalSapi = filteredSapi.length;
            const totalKambing = filteredKambing.length;
            
            // Gabungkan data sapi dan kambing
            const semuaHewan = [
                ...filteredSapi.map(sapi => ({
                    nama: sapi.nama,
                    jenis: 'Sapi',
                    keterangan: sapi.keterangan || '-',
                    pesertaTerisi: sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0,
                    maxPeserta: 7
                })),
                ...filteredKambing.map(kambing => ({
                    nama: kambing.jenis || 'Kambing',
                    jenis: kambing.jenis || 'Kambing',
                    keterangan: kambing.keterangan || '-',
                    pesertaTerisi: kambing.peserta && kambing.peserta.trim() !== '' ? 1 : 0,
                    maxPeserta: 1
                }))
            ];
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Jumlah Seluruh Hewan Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalHewan}</div>
                            <div style="color: #6b7280;">Total Seluruh Hewan</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${totalSapi}</div>
                            <div style="color: #6b7280;">Total Sapi</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${totalKambing}</div>
                            <div style="color: #6b7280;">Total Kambing</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Nama Hewan</th>
                                <th style="padding: 12px; text-align: left;">Jenis</th>
                                <th style="padding: 12px; text-align: left;">Peserta</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${semuaHewan.map((hewan, index) => {
                                const status = hewan.pesertaTerisi >= hewan.maxPeserta ? 'Penuh' : 'Tersedia';
                                const statusColor = status === 'Penuh' ? '#ef4444' : '#10b981';
                                return `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 12px;">${index + 1}</td>
                                        <td style="padding: 12px;">${hewan.nama}</td>
                                        <td style="padding: 12px;">${hewan.jenis}</td>
                                        <td style="padding: 12px;">${hewan.pesertaTerisi}/${hewan.maxPeserta}</td>
                                        <td style="padding: 12px;"><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${status}</span></td>
                                        <td style="padding: 12px;">${hewan.keterangan}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanHewanSapi(tahun) {
            // Filter data by year first
            const filteredSapi = sapiData.filter(s => (s.tahun || currentYear.toString()) === tahun);
            
            const totalSapi = filteredSapi.length;
            const sapiPenuh = filteredSapi.filter(sapi => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                return pesertaTerisi >= 7;
            }).length;
            const sapiTersedia = totalSapi - sapiPenuh;
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Jumlah Sapi Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalSapi}</div>
                            <div style="color: #6b7280;">Total Sapi</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${sapiTersedia}</div>
                            <div style="color: #6b7280;">Sapi Tersedia</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${sapiPenuh}</div>
                            <div style="color: #6b7280;">Sapi Penuh</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Nama Sapi</th>
                                <th style="padding: 12px; text-align: left;">Peserta (7 bagian)</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredSapi.map((sapi, index) => {
                                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                                const status = pesertaTerisi >= 7 ? 'Penuh' : 'Tersedia';
                                const statusColor = status === 'Penuh' ? '#ef4444' : '#10b981';
                                return `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 12px;">${index + 1}</td>
                                        <td style="padding: 12px;">${sapi.nama}</td>
                                        <td style="padding: 12px;">${pesertaTerisi}/7</td>
                                        <td style="padding: 12px;"><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${status}</span></td>
                                        <td style="padding: 12px;">${sapi.keterangan || '-'}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanHewanKambing(tahun) {
            // Filter data by year first
            const filteredKambing = kambingData.filter(k => (k.tahun || currentYear.toString()) === tahun);
            
            const totalKambing = filteredKambing.length;
            const kambingTerisi = filteredKambing.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '').length;
            const kambingTersedia = totalKambing - kambingTerisi;
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Jumlah Kambing Tahun ${tahun}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalKambing}</div>
                            <div style="color: #6b7280;">Total Kambing</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${kambingTersedia}</div>
                            <div style="color: #6b7280;">Kambing Tersedia</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${kambingTerisi}</div>
                            <div style="color: #6b7280;">Kambing Terisi</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">No</th>
                                <th style="padding: 12px; text-align: left;">Jenis Hewan</th>
                                <th style="padding: 12px; text-align: left;">Peserta</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                                <th style="padding: 12px; text-align: left;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${kambingData.map((kambing, index) => {
                                const status = kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia';
                                const statusColor = status === 'Terisi' ? '#ef4444' : '#10b981';
                                return `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 12px;">${index + 1}</td>
                                        <td style="padding: 12px;">${kambing.jenis || 'Kambing'}</td>
                                        <td style="padding: 12px;">${kambing.peserta || '-'}</td>
                                        <td style="padding: 12px;"><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${status}</span></td>
                                        <td style="padding: 12px;">${kambing.keterangan || '-'}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function generateLaporanPembagian() {
            const totalPembagian = pembagianData.length;
            const sudahDiambil = pembagianData.filter(p => p.status === 'Sudah Diambil').length;
            const belumDiambil = totalPembagian - sudahDiambil;
            const totalBeratDaging = pembagianData.reduce((sum, pembagian) => sum + pembagian.beratDaging, 0);
            
            return `
                <div style="padding: 20px;">
                    <h3 style="color: #1e5f3d; margin-bottom: 20px;"> Laporan Pembagian Qurban</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e5f3d;">${totalPembagian}</div>
                            <div style="color: #6b7280;">Total Pembagian</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;">${sudahDiambil}</div>
                            <div style="color: #6b7280;">Sudah Diambil</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${belumDiambil}</div>
                            <div style="color: #6b7280;">Belum Diambil</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${totalBeratDaging} kg</div>
                            <div style="color: #6b7280;">Total Daging</div>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: #1e5f3d; color: white;">
                                <th style="padding: 12px; text-align: left;">Peserta</th>
                                <th style="padding: 12px; text-align: left;">Hewan</th>
                                <th style="padding: 12px; text-align: left;">Bagian</th>
                                <th style="padding: 12px; text-align: left;">Berat Daging</th>
                                <th style="padding: 12px; text-align: left;">Tanggal</th>
                                <th style="padding: 12px; text-align: left;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pembagianData.map(pembagian => {
                                const peserta = pesertaData.find(p => p.id === pembagian.pesertaId);
                                const hewan = hewanData.find(h => h.id === pembagian.hewanId);
                                const statusColor = pembagian.status === 'Sudah Diambil' ? '#10b981' : '#f59e0b';
                                return `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 12px;">${peserta ? peserta.nama : '-'}</td>
                                        <td style="padding: 12px;">${hewan ? `${hewan.jenis} ${hewan.berat}kg` : '-'}</td>
                                        <td style="padding: 12px;">${pembagian.jumlahBagian}</td>
                                        <td style="padding: 12px;">${pembagian.beratDaging} kg</td>
                                        <td style="padding: 12px;">${pembagian.tanggalPembagian}</td>
                                        <td style="padding: 12px;"><span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${pembagian.status}</span></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function exportLaporanPDF() {
            const jenisLaporan = document.getElementById('jenisLaporan').value;
            const tahunLaporan = document.getElementById('tahunLaporan').value;
            
            if (!jenisLaporan) {
                alert('Pilih jenis laporan terlebih dahulu!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get report title
            const reportTitles = {
                'panitia': 'Laporan Data Panitia',
                'mustahik': 'Laporan Data Mustahik',
                'peserta-semua': 'Laporan Data Seluruh Peserta Qurban',
                'peserta-sapi': 'Laporan Data Peserta Qurban Sapi',
                'peserta-kambing': 'Laporan Data Peserta Qurban Kambing',
                'hewan-semua': 'Laporan Jumlah Seluruh Hewan',
                'hewan-sapi': 'Laporan Jumlah Sapi',
                'hewan-kambing': 'Laporan Jumlah Kambing'
            };
            
            doc.setFontSize(16);
            doc.text(reportTitles[jenisLaporan] + ` Tahun ${tahunLaporan}`, 20, 20);
            doc.setFontSize(12);
            doc.text(`${pengaturanData.namaOrganisasi}`, 20, 30);
            doc.text(`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`, 20, 40);
            
            // Add specific content based on report type
            let tableData = [];
            let headers = [];
            
            switch (jenisLaporan) {
                case 'panitia':
                    headers = ['No', 'Nama', 'Jabatan', 'No. HP', 'Status'];
                    tableData = pesertaData.map((panitia, index) => [
                        index + 1, panitia.nama, panitia.jabatan || panitia.jenis || '-', 
                        panitia.telepon || '-', panitia.status || 'aktif'
                    ]);
                    break;
                case 'mustahik':
                    headers = ['No', 'Nama Mustahik', 'RT', 'Status'];
                    tableData = mustahikData.map((mustahik, index) => [
                        index + 1, mustahik.nama, mustahik.rt, mustahik.status || 'aktif'
                    ]);
                    break;
                case 'peserta-semua':
                    headers = ['No', 'Nama Peserta', 'Jenis Hewan', 'Nama Hewan'];
                    const pesertaSapi = sapiData.reduce((acc, sapi) => {
                        if (sapi.peserta) {
                            sapi.peserta.forEach((nama, index) => {
                                if (nama && nama.trim() !== '') {
                                    acc.push([nama, 'Sapi', sapi.nama]);
                                }
                            });
                        }
                        return acc;
                    }, []);
                    const pesertaKambing = kambingData.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '')
                        .map(kambing => [kambing.peserta, kambing.jenis || 'Kambing', kambing.jenis || 'Kambing']);
                    const semuaPeserta = [...pesertaSapi, ...pesertaKambing];
                    tableData = semuaPeserta.map((peserta, index) => [index + 1, ...peserta]);
                    break;
                case 'peserta-sapi':
                    headers = ['No', 'Nama Pequrban', 'Nama Sapi', 'Keterangan'];
                    tableData = sapiData.reduce((acc, sapi) => {
                        if (sapi.peserta) {
                            sapi.peserta.forEach((nama, index) => {
                                if (nama && nama.trim() !== '') {
                                    acc.push([acc.length + 1, nama, sapi.nama, sapi.keterangan || '-']);
                                }
                            });
                        }
                        return acc;
                    }, []);
                    break;
                case 'peserta-kambing':
                    headers = ['No', 'Nama Peserta', 'Jenis Hewan', 'Keterangan'];
                    tableData = kambingData.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '')
                        .map((kambing, index) => [index + 1, kambing.peserta, kambing.jenis || 'Kambing', kambing.keterangan || '-']);
                    break;
                case 'hewan-semua':
                    headers = ['No', 'Nama Hewan', 'Jenis', 'Peserta', 'Status', 'Keterangan'];
                    const semuaHewan = [
                        ...sapiData.map(sapi => {
                            const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                            return [sapi.nama, 'Sapi', `${pesertaTerisi}/7`, pesertaTerisi >= 7 ? 'Penuh' : 'Tersedia', sapi.keterangan || '-'];
                        }),
                        ...kambingData.map(kambing => {
                            const pesertaTerisi = kambing.peserta && kambing.peserta.trim() !== '' ? 1 : 0;
                            return [kambing.jenis || 'Kambing', kambing.jenis || 'Kambing', `${pesertaTerisi}/1`, pesertaTerisi >= 1 ? 'Terisi' : 'Tersedia', kambing.keterangan || '-'];
                        })
                    ];
                    tableData = semuaHewan.map((hewan, index) => [index + 1, ...hewan]);
                    break;
                case 'hewan-sapi':
                    headers = ['No', 'Nama Sapi', 'Peserta (7 bagian)', 'Status', 'Keterangan'];
                    tableData = sapiData.map((sapi, index) => {
                        const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                        return [index + 1, sapi.nama, `${pesertaTerisi}/7`, pesertaTerisi >= 7 ? 'Penuh' : 'Tersedia', sapi.keterangan || '-'];
                    });
                    break;
                case 'hewan-kambing':
                    headers = ['No', 'Jenis Hewan', 'Peserta', 'Status', 'Keterangan'];
                    tableData = kambingData.map((kambing, index) => {
                        const status = kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia';
                        return [index + 1, kambing.jenis || 'Kambing', kambing.peserta || '-', status, kambing.keterangan || '-'];
                    });
                    break;
            }
            
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 50,
                styles: { fontSize: 8 }
            });
            
            doc.save(`${reportTitles[jenisLaporan].toLowerCase().replace(/\s+/g, '-')}-${tahunLaporan}.pdf`);
        }

        function exportLaporanExcel() {
            const jenisLaporan = document.getElementById('jenisLaporan').value;
            const tahunLaporan = document.getElementById('tahunLaporan').value;
            
            if (!jenisLaporan) {
                alert('Pilih jenis laporan terlebih dahulu!');
                return;
            }
            
            const reportTitles = {
                'panitia': 'LAPORAN DATA PANITIA',
                'guru': 'LAPORAN DATA GURU & SEPUH',
                'mustahik': 'LAPORAN DATA MUSTAHIK',
                'mustahik-per-rt': 'LAPORAN DATA MUSTAHIK PER RT',
                'peserta-semua': 'LAPORAN DATA SELURUH PESERTA QURBAN',
                'peserta-sapi': 'LAPORAN DATA PESERTA QURBAN SAPI',
                'peserta-kambing': 'LAPORAN DATA PESERTA QURBAN KAMBING',
                'hewan-semua': 'LAPORAN JUMLAH SELURUH HEWAN',
                'hewan-sapi': 'LAPORAN JUMLAH SAPI',
                'hewan-kambing': 'LAPORAN JUMLAH KAMBING'
            };
            
            let data = [];
            let colWidths = [];
            
            switch (jenisLaporan) {
                case 'panitia':
                    data = pesertaData.map((panitia, index) => ({
                        'No': index + 1,
                        'Nama Lengkap': panitia.nama,
                        'Jabatan': panitia.jabatan || panitia.jenis || '-',
                        'No. HP': panitia.telepon || '-',
                        'Tahun': panitia.tahun || tahunLaporan,
                        'Status': panitia.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                        'Keterangan': panitia.keterangan || '-'
                    }));
                    colWidths = [{ wch: 5 }, { wch: 25 }, { wch: 18 }, { wch: 15 }, { wch: 8 }, { wch: 12 }, { wch: 30 }];
                    break;
                case 'guru':
                    data = guruData.map((guru, index) => ({
                        'No': index + 1,
                        'Nama Lengkap': guru.nama,
                        'Kategori': guru.kategori || '-',
                        'Tahun': guru.tahun || tahunLaporan,
                        'Status': guru.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'
                    }));
                    colWidths = [{ wch: 5 }, { wch: 25 }, { wch: 15 }, { wch: 8 }, { wch: 12 }];
                    break;
                case 'mustahik':
                    const rtFilter = document.getElementById('rtLaporanFilter') ? document.getElementById('rtLaporanFilter').value : '';
                    let filteredMustahik = mustahikData;
                    if (rtFilter) {
                        filteredMustahik = mustahikData.filter(m => m.rt === rtFilter);
                    }
                    data = filteredMustahik.map((mustahik, index) => ({
                        'No': index + 1,
                        'Nama Mustahik': mustahik.nama,
                        'RT': mustahik.rt,
                        'Tahun': mustahik.tahun || tahunLaporan,
                        'Status': mustahik.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'
                    }));
                    colWidths = [{ wch: 5 }, { wch: 25 }, { wch: 12 }, { wch: 8 }, { wch: 12 }];
                    break;
                case 'peserta-semua':
                    const pesertaSapi = sapiData.reduce((acc, sapi) => {
                        if (sapi.peserta) {
                            sapi.peserta.forEach((nama, index) => {
                                if (nama && nama.trim() !== '') {
                                    acc.push({
                                        nama: nama,
                                        jenis: 'Sapi',
                                        namaHewan: sapi.nama
                                    });
                                }
                            });
                        }
                        return acc;
                    }, []);
                    const pesertaKambing = kambingData.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '')
                        .map(kambing => ({
                            nama: kambing.peserta,
                            jenis: kambing.jenis || 'Kambing',
                            namaHewan: kambing.jenis || 'Kambing'
                        }));
                    const semuaPeserta = [...pesertaSapi, ...pesertaKambing];
                    data = semuaPeserta.map((peserta, index) => ({
                        'No': index + 1,
                        'Nama Peserta': peserta.nama,
                        'Jenis Hewan': peserta.jenis,
                        'Nama Hewan': peserta.namaHewan
                    }));
                    colWidths = [{ wch: 5 }, { wch: 25 }, { wch: 15 }, { wch: 20 }];
                    break;
                case 'hewan-sapi':
                    data = sapiData.map((sapi, index) => {
                        const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                        return {
                            'No': index + 1,
                            'Nama Sapi': sapi.nama,
                            'Peserta': `${pesertaTerisi}/7`,
                            'Status': pesertaTerisi >= 7 ? 'Penuh' : 'Tersedia',
                            'Tahun': sapi.tahun || tahunLaporan,
                            'Keterangan': sapi.keterangan || '-'
                        };
                    });
                    colWidths = [{ wch: 5 }, { wch: 15 }, { wch: 12 }, { wch: 12 }, { wch: 8 }, { wch: 25 }];
                    break;
                case 'hewan-kambing':
                    data = kambingData.map((kambing, index) => {
                        const status = kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia';
                        return {
                            'No': index + 1,
                            'Jenis Hewan': kambing.jenis || 'Kambing',
                            'Peserta': kambing.peserta || '-',
                            'Status': status,
                            'Tahun': kambing.tahun || tahunLaporan,
                            'Keterangan': kambing.keterangan || '-'
                        };
                    });
                    colWidths = [{ wch: 5 }, { wch: 15 }, { wch: 25 }, { wch: 12 }, { wch: 8 }, { wch: 25 }];
                    break;
            }
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(data);
            
            // Set column widths
            ws['!cols'] = colWidths;
            
            // Add header row styling
            const range = XLSX.utils.decode_range(ws['!ref']);
            
            // Style header row
            for (let C = range.s.c; C <= range.e.c; ++C) {
                const address = XLSX.utils.encode_cell({ r: 0, c: C });
                if (!ws[address]) continue;
                ws[address].s = {
                    font: { bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "1E5F3D" } },
                    alignment: { horizontal: "center", vertical: "center" },
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };
            }
            
            // Style data rows
            for (let R = range.s.r + 1; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[address]) continue;
                    
                    ws[address].s = {
                        alignment: { horizontal: C === 0 ? "center" : "left", vertical: "center" },
                        border: {
                            top: { style: "thin", color: { rgb: "CCCCCC" } },
                            bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                            left: { style: "thin", color: { rgb: "CCCCCC" } },
                            right: { style: "thin", color: { rgb: "CCCCCC" } }
                        },
                        fill: { fgColor: { rgb: R % 2 === 0 ? "F8F9FA" : "FFFFFF" } }
                    };
                }
            }
            
            // Add title and organization info
            XLSX.utils.sheet_add_aoa(ws, [
                [reportTitles[jenisLaporan]],
                [`${pengaturanData.namaOrganisasi}`],
                [`${pengaturanData.alamatOrganisasi}`],
                [`Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`],
                [`Dicetak pada: ${new Date().toLocaleDateString('id-ID')}`],
                []
            ], { origin: -1 });
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, reportTitles[jenisLaporan].replace('LAPORAN ', ''));
            XLSX.writeFile(wb, `${reportTitles[jenisLaporan].toLowerCase().replace(/\s+/g, '-')}-${tahunLaporan}.xlsx`);
        }

        function printLaporan() {
            const jenisLaporan = document.getElementById('jenisLaporan').value;
            const tahunLaporan = document.getElementById('tahunLaporan').value;
            
            if (!jenisLaporan) {
                alert('Pilih jenis laporan terlebih dahulu!');
                return;
            }
            
            // Get the current report content
            const laporanContent = document.getElementById('laporanContent').innerHTML;
            
            if (laporanContent.includes('Pilih jenis laporan')) {
                alert('Silakan generate laporan terlebih dahulu!');
                return;
            }
            
            // Get report title
            const reportTitles = {
                'panitia': 'Laporan Data Panitia',
                'guru': 'Laporan Data Guru & Sepuh',
                'mustahik': 'Laporan Data Mustahik',
                'mustahik-per-rt': 'Laporan Data Mustahik Per RT',
                'peserta-semua': 'Laporan Data Seluruh Peserta Qurban',
                'peserta-sapi': 'Laporan Data Peserta Qurban Sapi',
                'peserta-kambing': 'Laporan Data Peserta Qurban Kambing',
                'hewan-semua': 'Laporan Jumlah Seluruh Hewan',
                'hewan-sapi': 'Laporan Jumlah Sapi',
                'hewan-kambing': 'Laporan Jumlah Kambing'
            };
            
            const reportTitle = reportTitles[jenisLaporan] || 'Laporan';
            
            // Create print content with header
            const printContent = `
                <div class="header">
                    <div class="header-content">
                        <div class="header-title">
                            <div id="headerLogo">
                                ${pengaturanData.logoBase64 ? 
                                    `<img src="${pengaturanData.logoBase64}" alt="Logo" class="logo-image-header">` : 
                                    `<svg width="30" height="30" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="50" cy="50" r="45" fill="#1e5f3d"/>
                                        <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white"/>
                                        <circle cx="50" cy="55" r="8" fill="#1e5f3d"/>
                                        <path d="M42 75 L58 75" stroke="white" stroke-width="3"/>
                                    </svg>`
                                }
                            </div>
                            <div>
                                <h1>Sistem Manajemen Qurban</h1>
                                <div style="color: #2d8659; font-size: 14px; font-weight: 600;">${pengaturanData.namaOrganisasi}</div>
                                <div style="color: #6b7280; font-size: 12px; margin-top: 2px;">${pengaturanData.alamatOrganisasi}</div>
                                <div style="color: #6b7280; font-size: 12px;">Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section active">
                    ${laporanContent}
                </div>
            `;
            
            printData(printContent);
        }

        // Print Functions for Data Sections
        function printDataPanitia() {
            // Apply current filters
            const searchTerm = document.getElementById('searchPeserta').value.toLowerCase();
            const jenisFilter = document.getElementById('filterJenisPeserta').value;
            const tahunFilter = document.getElementById('filterTahunPeserta').value;
            
            let filteredData = pesertaData.filter(panitia => {
                const matchSearch = panitia.nama.toLowerCase().includes(searchTerm);
                const matchJabatan = !jenisFilter || (panitia.jabatan || panitia.jenis || '').toLowerCase() === jenisFilter;
                const matchTahun = !tahunFilter || (panitia.tahun || currentYear.toString()) === tahunFilter;
                return matchSearch && matchJabatan && matchTahun;
            });
            
            const printContent = generatePrintContent('panitia', 'Data Panitia', filteredData, [
                'No', 'Nama Lengkap', 'Jabatan', 'No. HP', 'Tahun', 'Status', 'Keterangan'
            ], (panitia, index) => [
                index + 1,
                panitia.nama,
                panitia.jabatan || panitia.jenis || '-',
                panitia.telepon || '-',
                panitia.tahun || currentYear.toString(),
                panitia.status === 'aktif' ? 'Aktif' : 'Tidak Aktif',
                panitia.keterangan || '-'
            ]);
            
            printData(printContent);
        }

        function printDataGuru() {
            // Apply current filters
            const searchTerm = document.getElementById('searchGuru').value.toLowerCase();
            const jenisFilter = document.getElementById('filterJenisGuru').value;
            const tahunFilter = document.getElementById('filterTahunGuru').value;
            
            let filteredData = guruData.filter(guru => {
                const matchSearch = guru.nama.toLowerCase().includes(searchTerm);
                const matchKategori = !jenisFilter || (guru.kategori || '').toLowerCase() === jenisFilter;
                const matchTahun = !tahunFilter || (guru.tahun || currentYear.toString()) === tahunFilter;
                return matchSearch && matchKategori && matchTahun;
            });
            
            const printContent = generatePrintContent('guru', 'Data Guru & Sepuh', filteredData, [
                'No', 'Nama Lengkap', 'Kategori', 'Tahun', 'Status'
            ], (guru, index) => [
                index + 1,
                guru.nama,
                guru.kategori || '-',
                guru.tahun || currentYear.toString(),
                guru.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'
            ]);
            
            printData(printContent);
        }

        function printDataSapi() {
            // Apply current filters
            const jenisFilter = document.getElementById('filterJenisSapi').value;
            const statusFilter = document.getElementById('filterStatusSapi').value;
            const tahunFilter = document.getElementById('filterTahunSapi').value;
            
            let filteredData = sapiData.filter(sapi => {
                const matchJenis = !jenisFilter || sapi.nama.toLowerCase().includes(jenisFilter.toLowerCase());
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                const status = pesertaTerisi >= 7 ? 'penuh' : 'tersedia';
                const matchStatus = !statusFilter || status === statusFilter;
                const matchTahun = !tahunFilter || (sapi.tahun || currentYear.toString()) === tahunFilter;
                return matchJenis && matchStatus && matchTahun;
            });
            
            const printContent = generatePrintContent('sapi', 'Data Qurban Sapi', filteredData, [
                'No', 'Nama Sapi', 'Peserta (7 bagian)', 'Tahun', 'Status', 'Keterangan'
            ], (sapi, index) => {
                const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                const pesertaList = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').join(', ') : '-';
                return [
                    index + 1,
                    sapi.nama,
                    pesertaList,
                    sapi.tahun || currentYear.toString(),
                    `${pesertaTerisi >= 7 ? 'Penuh' : 'Tersedia'} (${pesertaTerisi}/7)`,
                    sapi.keterangan || '-'
                ];
            });
            
            printData(printContent);
        }

        function printDataKambing() {
            // Apply current filters
            const searchTerm = document.getElementById('searchKambing').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatusKambing').value;
            const tahunFilter = document.getElementById('filterTahunKambing').value;
            
            let filteredData = kambingData.filter(kambing => {
                const matchSearch = (kambing.jenis || kambing.nama || '').toLowerCase().includes(searchTerm) || 
                                  (kambing.peserta || '').toLowerCase().includes(searchTerm);
                const status = kambing.peserta && kambing.peserta.trim() !== '' ? 'terisi' : 'tersedia';
                const matchStatus = !statusFilter || status === statusFilter;
                const matchTahun = !tahunFilter || (kambing.tahun || currentYear.toString()) === tahunFilter;
                return matchSearch && matchStatus && matchTahun;
            });
            
            const printContent = generatePrintContent('kambing', 'Data Qurban Kambing', filteredData, [
                'No', 'Jenis Hewan', 'Peserta', 'Tahun', 'Status', 'Keterangan'
            ], (kambing, index) => [
                index + 1,
                kambing.jenis || kambing.nama || 'Kambing',
                kambing.peserta || '-',
                kambing.tahun || currentYear.toString(),
                kambing.peserta && kambing.peserta.trim() !== '' ? 'Terisi' : 'Tersedia',
                kambing.keterangan || '-'
            ]);
            
            printData(printContent);
        }

        function printDataMustahik() {
            // Apply current filters
            const searchTerm = document.getElementById('searchMustahik').value.toLowerCase();
            const rtFilter = document.getElementById('filterRTMustahik').value;
            const statusFilter = document.getElementById('filterStatusMustahik').value;
            const tahunFilter = document.getElementById('filterTahunMustahik').value;
            
            let filteredData = mustahikData.filter(mustahik => {
                const matchSearch = mustahik.nama.toLowerCase().includes(searchTerm);
                const matchRT = !rtFilter || mustahik.rt === rtFilter;
                const matchStatus = !statusFilter || (mustahik.status || 'aktif') === statusFilter;
                const matchTahun = !tahunFilter || (mustahik.tahun || currentYear.toString()) === tahunFilter;
                return matchSearch && matchRT && matchStatus && matchTahun;
            });
            
            const printContent = generatePrintContent('mustahik', 'Data Mustahik', filteredData, [
                'No', 'Nama Mustahik', 'RT', 'Tahun', 'Status'
            ], (mustahik, index) => [
                index + 1,
                mustahik.nama,
                mustahik.rt,
                mustahik.tahun || currentYear.toString(),
                mustahik.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'
            ]);
            
            printData(printContent);
        }

        function generatePrintContent(type, title, data, headers, rowMapper) {
            // Generate statistics
            let stats = '';
            if (type === 'panitia') {
                const totalPanitia = data.length;
                const panitiaAktif = data.filter(p => p.status === 'aktif').length;
                const panitiaTidakAktif = totalPanitia - panitiaAktif;
                stats = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalPanitia}</div>
                            <div class="stat-label">Total Panitia</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${panitiaAktif}</div>
                            <div class="stat-label">Panitia Aktif</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${panitiaTidakAktif}</div>
                            <div class="stat-label">Panitia Tidak Aktif</div>
                        </div>
                    </div>
                `;
            } else if (type === 'guru') {
                const totalGuru = data.length;
                const guruAktif = data.filter(g => g.status === 'aktif').length;
                const guruTidakAktif = totalGuru - guruAktif;
                stats = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalGuru}</div>
                            <div class="stat-label">Total Guru & Sepuh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${guruAktif}</div>
                            <div class="stat-label">Guru & Sepuh Aktif</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${guruTidakAktif}</div>
                            <div class="stat-label">Guru & Sepuh Tidak Aktif</div>
                        </div>
                    </div>
                `;
            } else if (type === 'sapi') {
                const totalSapi = data.length;
                const sapiPenuh = data.filter(sapi => {
                    const pesertaTerisi = sapi.peserta ? sapi.peserta.filter(p => p && p.trim() !== '').length : 0;
                    return pesertaTerisi >= 7;
                }).length;
                const sapiTersedia = totalSapi - sapiPenuh;
                stats = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalSapi}</div>
                            <div class="stat-label">Total Sapi</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${sapiTersedia}</div>
                            <div class="stat-label">Sapi Tersedia</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${sapiPenuh}</div>
                            <div class="stat-label">Sapi Penuh</div>
                        </div>
                    </div>
                `;
            } else if (type === 'kambing') {
                const totalKambing = data.length;
                const kambingTerisi = data.filter(kambing => kambing.peserta && kambing.peserta.trim() !== '').length;
                const kambingTersedia = totalKambing - kambingTerisi;
                stats = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalKambing}</div>
                            <div class="stat-label">Total Kambing</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${kambingTersedia}</div>
                            <div class="stat-label">Kambing Tersedia</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${kambingTerisi}</div>
                            <div class="stat-label">Kambing Terisi</div>
                        </div>
                    </div>
                `;
            } else if (type === 'mustahik') {
                const totalMustahik = data.length;
                const mustahikAktif = data.filter(m => m.status === 'aktif').length;
                const mustahikTidakAktif = totalMustahik - mustahikAktif;
                stats = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalMustahik}</div>
                            <div class="stat-label">Total Mustahik</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${mustahikAktif}</div>
                            <div class="stat-label">Mustahik Aktif</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${mustahikTidakAktif}</div>
                            <div class="stat-label">Mustahik Tidak Aktif</div>
                        </div>
                    </div>
                `;
            }

            // Generate table rows
            const tableRows = data.map((item, index) => {
                const rowData = rowMapper(item, index);
                return `
                    <tr>
                        ${rowData.map(cell => `<td>${cell}</td>`).join('')}
                    </tr>
                `;
            }).join('');

            return `
                <div class="header">
                    <div class="header-content">
                        <div class="header-title">
                            <div id="headerLogo">
                                ${pengaturanData.logoBase64 ? 
                                    `<img src="${pengaturanData.logoBase64}" alt="Logo" class="logo-image-header">` : 
                                    `<svg width="30" height="30" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="50" cy="50" r="45" fill="#1e5f3d"/>
                                        <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white"/>
                                        <circle cx="50" cy="55" r="8" fill="#1e5f3d"/>
                                        <path d="M42 75 L58 75" stroke="white" stroke-width="3"/>
                                    </svg>`
                                }
                            </div>
                            <div>
                                <h1>Sistem Manajemen Qurban</h1>
                                <div style="color: #2d8659; font-size: 14px; font-weight: 600;">${pengaturanData.namaOrganisasi}</div>
                                <div style="color: #6b7280; font-size: 12px;">Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section active">
                    <h2 class="section-title">${title}</h2>
                    
                    ${stats}
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    ${headers.map(header => `<th>${header}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function printData(content) {
            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print Data - Sistem Manajemen Qurban</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                            -webkit-print-color-adjust: exact !important;
                            color-adjust: exact !important;
                        }
                        
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            background: white;
                            font-size: 12px;
                            line-height: 1.4;
                            margin: 0;
                            padding: 15px;
                        }
                        
                        .header {
                            background: white !important;
                            border-bottom: 2px solid #1e5f3d;
                            margin-bottom: 20px;
                            padding: 15px 0;
                        }
                        
                        .header-content {
                            display: flex;
                            align-items: center;
                            gap: 15px;
                        }
                        
                        .header-title {
                            display: flex;
                            align-items: center;
                            gap: 15px;
                        }
                        
                        .header h1 {
                            color: #1e5f3d;
                            font-size: 18px !important;
                            margin-bottom: 5px;
                        }
                        
                        .logo-image-header {
                            max-height: 30px;
                            width: auto;
                            border-radius: 5px;
                        }
                        
                        .content-section {
                            background: white !important;
                            padding: 0 !important;
                            margin: 0 !important;
                        }
                        
                        .section-title {
                            font-size: 16px !important;
                            margin-bottom: 15px !important;
                            border-bottom: 1px solid #1e5f3d;
                            padding-bottom: 5px;
                            color: #1e5f3d;
                        }
                        
                        .stats-grid {
                            display: grid !important;
                            grid-template-columns: repeat(4, 1fr) !important;
                            gap: 10px !important;
                            margin-bottom: 20px !important;
                        }
                        
                        .stat-card {
                            border: 1px solid #ccc !important;
                            padding: 10px !important;
                            text-align: center !important;
                            background: #f8f9fa !important;
                            border-radius: 5px;
                        }
                        
                        .stat-number {
                            font-size: 18px !important;
                            font-weight: bold !important;
                            color: #1e5f3d !important;
                            margin-bottom: 5px;
                        }
                        
                        .stat-label {
                            font-size: 10px !important;
                            color: #666 !important;
                        }
                        
                        .table-container {
                            overflow: visible !important;
                            border-radius: 0 !important;
                            box-shadow: none !important;
                        }
                        
                        table {
                            width: 100% !important;
                            border-collapse: collapse !important;
                            font-size: 10px !important;
                            margin-top: 10px !important;
                        }
                        
                        th, td {
                            border: 1px solid #333 !important;
                            padding: 6px 4px !important;
                            text-align: left !important;
                            vertical-align: top !important;
                        }
                        
                        th {
                            background: #1e5f3d !important;
                            color: white !important;
                            font-weight: bold !important;
                            font-size: 9px !important;
                        }
                        
                        tr:nth-child(even) {
                            background: #f8f9fa !important;
                        }
                        
                        @page {
                            margin: 1cm;
                            @top-center {
                                content: "Sistem Manajemen Qurban";
                            }
                            @bottom-center {
                                content: "Halaman " counter(page);
                            }
                        }
                        
                        @media print {
                            body { margin: 0; padding: 10px; }
                            .stats-grid { grid-template-columns: repeat(3, 1fr) !important; }
                        }
                    </style>
                </head>
                <body>
                    ${content}
                    <div style="margin-top: 20px; font-size: 10px; color: #666; text-align: center;">
                        Dicetak pada: ${new Date().toLocaleDateString('id-ID', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            // Wait for content to load then print
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        // Berkas Panitia Upload Functions
        function uploadSusunanFiles() {
            const fileInput = document.getElementById('uploadSusunanFiles');
            const tahunSelect = document.getElementById('tahunBerkasPanitia');
            const files = fileInput.files;
            
            if (!files || files.length === 0) {
                alert('Pilih file yang akan diupload!');
                return;
            }
            
            const selectedYear = tahunSelect.value;
            if (!selectedYear) {
                alert('Pilih tahun berkas terlebih dahulu!');
                return;
            }
            
            let uploadedCount = 0;
            let failedCount = 0;
            const totalFiles = files.length;
            const uploadedFiles = [];
            
            Array.from(files).forEach((file, index) => {
                // Validate file type - PDF only
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (fileExtension !== '.pdf') {
                    alert(`File ${file.name} format tidak didukung! Hanya PDF yang diperbolehkan.`);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishUpload();
                    }
                    return;
                }
                
                // Validate file size (10MB max)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`File ${file.name} terlalu besar! Maksimal 10MB.`);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishUpload();
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const fileData = {
                            id: Date.now() + Math.random() * 1000 + index,
                            name: file.name,
                            type: file.type,
                            extension: fileExtension,
                            data: e.target.result,
                            size: file.size,
                            uploadDate: new Date().toISOString(),
                            tahun: selectedYear
                        };
                        
                        susunanFilesData.push(fileData);
                        uploadedFiles.push(file.name);
                        uploadedCount++;
                        
                        // Save to localStorage immediately for permanent storage
                        localStorage.setItem('susunanFilesData', JSON.stringify(susunanFilesData));
                        
                        if (uploadedCount + failedCount === totalFiles) {
                            finishUpload();
                        }
                    } catch (error) {
                        console.error('Error processing file:', error);
                        failedCount++;
                        if (uploadedCount + failedCount === totalFiles) {
                            finishUpload();
                        }
                    }
                };
                
                reader.onerror = function() {
                    console.error('Error reading file:', file.name);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishUpload();
                    }
                };
                
                reader.readAsDataURL(file);
            });
            
            function finishUpload() {
                // Ensure final save to localStorage for permanent storage
                localStorage.setItem('susunanFilesData', JSON.stringify(susunanFilesData));
                loadSusunanPanitia();
                fileInput.value = '';
                
                if (uploadedCount > 0) {
                    // Show success notification with file details
                    let successMessage = ` BERHASIL UPLOAD!\n\n`;
                    successMessage += ` ${uploadedCount} file berhasil diupload untuk tahun ${selectedYear}\n\n`;
                    successMessage += ` File yang diupload:\n`;
                    uploadedFiles.forEach((fileName, index) => {
                        successMessage += `${index + 1}. ${fileName}\n`;
                    });
                    
                    if (failedCount > 0) {
                        successMessage += `\n ${failedCount} file gagal diupload`;
                    }
                    
                    successMessage += `\n Data tersimpan permanen di sistem`;
                    
                    alert(successMessage);
                } else {
                    alert(' Tidak ada file yang berhasil diupload!');
                }
            }
        }

        function hapusSemuaFileSusunan() {
            if (susunanFilesData.length === 0) {
                alert('Tidak ada file untuk dihapus!');
                return;
            }
            
            if (confirm(` KONFIRMASI HAPUS SEMUA FILE\n\nApakah Anda yakin ingin menghapus SEMUA ${susunanFilesData.length} file berkas panitia?\n\n Total File: ${susunanFilesData.length}\n Total Ukuran: ${(susunanFilesData.reduce((sum, f) => sum + f.size, 0) / 1024 / 1024).toFixed(2)} MB\n\n Semua file yang dihapus tidak dapat dikembalikan!\n\n Tindakan ini akan menghapus SELURUH berkas panitia!`)) {
                susunanFilesData = [];
                localStorage.setItem('susunanFilesData', JSON.stringify(susunanFilesData));
                loadSusunanPanitia();
                alert(' Semua file berhasil dihapus!');
            }
        }

        function hapusFileSusunan(fileId) {
            const file = susunanFilesData.find(f => f.id == fileId);
            if (!file) return;
            
            if (confirm(` KONFIRMASI HAPUS FILE\n\nApakah Anda yakin ingin menghapus file ini?\n\n Nama File: ${file.name}\n Diupload: ${new Date(file.uploadDate).toLocaleDateString('id-ID')}\n Ukuran: ${(file.size / 1024 / 1024).toFixed(2)} MB\n\n File yang dihapus tidak dapat dikembalikan!`)) {
                susunanFilesData = susunanFilesData.filter(f => f.id != fileId);
                localStorage.setItem('susunanFilesData', JSON.stringify(susunanFilesData));
                loadSusunanPanitia();
                alert(' File berhasil dihapus!');
            }
        }

        function downloadSusunanFile(fileId) {
            const file = susunanFilesData.find(f => f.id == fileId);
            if (!file) return;
            
            const link = document.createElement('a');
            link.href = file.data;
            link.download = file.name;
            link.click();
        }

        function downloadAllSusunanFiles() {
            if (susunanFilesData.length === 0) {
                alert('Tidak ada file untuk didownload!');
                return;
            }
            
            if (confirm(`Download ${susunanFilesData.length} file? Ini mungkin memakan waktu beberapa saat.`)) {
                susunanFilesData.forEach((file, index) => {
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = file.data;
                        link.download = `${index + 1}_${file.name}`;
                        link.click();
                    }, index * 500); // Delay 500ms between downloads
                });
            }
        }

        function previewSusunanFile(fileId) {
            const file = susunanFilesData.find(f => f.id == fileId);
            if (!file) return;
            
            const modal = document.getElementById('fileModal');
            const modalContent = document.getElementById('fileModalContent');
            const modalInfo = document.getElementById('modalFileInfo');
            
            const uploadDate = new Date(file.uploadDate).toLocaleDateString('id-ID');
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            
            modalInfo.innerHTML = `
                <strong>${file.name}</strong><br>
                Diupload: ${uploadDate} | Ukuran: ${fileSize} MB | Format: ${file.extension.toUpperCase()}
            `;
            
            if (file.extension === '.pdf') {
                // Display PDF in iframe
                modalContent.innerHTML = `<iframe src="${file.data}" style="width: 100%; height: 80vh; border: none; border-radius: 10px; background: white;"></iframe>`;
            } else if (['.jpg', '.jpeg'].includes(file.extension)) {
                // Display image
                modalContent.innerHTML = `<img src="${file.data}" alt="${file.name}" style="max-width: 100%; max-height: 80vh; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">`;
            } else {
                // Display preview for DOC/DOCX files
                modalContent.innerHTML = `
                    <div class="file-modal-preview">
                        <div class="file-icon"></div>
                        <h4>${file.name}</h4>
                        <p>Dokumen Microsoft Word tidak dapat ditampilkan langsung di browser.<br>
                        Klik tombol download untuk membuka dokumen.</p>
                        <button class="doc-download-btn" onclick="downloadSusunanFile(${file.id}); closeFileModal();">
                             Download & Buka Dokumen
                        </button>
                    </div>
                `;
            }
            
            modal.style.display = 'block';
        }

        function closeFileModal() {
            document.getElementById('fileModal').style.display = 'none';
        }

        function filterBerkasPanitia() {
            const searchTerm = document.getElementById('searchBerkasPanitia').value.toLowerCase();
            const tahunFilter = document.getElementById('filterTahunSusunan').value;
            
            let filteredFiles = susunanFilesData;
            
            if (searchTerm) {
                filteredFiles = filteredFiles.filter(file => 
                    file.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (tahunFilter) {
                filteredFiles = filteredFiles.filter(file => file.tahun === tahunFilter);
            }
            
            displayFilteredSusunanFiles(filteredFiles);
        }

        function displaySusunanFiles() {
            displayFilteredSusunanFiles(susunanFilesData);
        }

        function displayFilteredSusunanFiles(filteredFiles) {
            const filesArea = document.getElementById('susunanFilesArea');
            const totalFileSpan = document.getElementById('totalFileSusunan');
            
            if (totalFileSpan) {
                totalFileSpan.textContent = susunanFilesData.length;
            }
            
            if (!filesArea) {
                console.error('Files area not found');
                return;
            }
            
            if (filteredFiles.length === 0) {
                filesArea.innerHTML = `
                    <div class="empty-tiles">
                        <div class="empty-tiles-icon"></div>
                        <div class="empty-tiles-title">Belum ada berkas panitia</div>
                        <div class="empty-tiles-subtitle">Admin dapat mengupload berkas PDF tanpa batas melalui form di atas</div>
                    </div>
                `;
                return;
            }
            
            // Change to small icons grid layout
            filesArea.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;">
                    ${filteredFiles.map(file => {
                        const uploadDate = new Date(file.uploadDate).toLocaleDateString('id-ID');
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        
                        return `
                            <div class="small-file-card" style="background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.15)'" 
                                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                                <div onclick="previewSusunanFile(${file.id})" style="cursor: pointer;">
                                    <div style="font-size: 32px; margin-bottom: 8px; color: #ef4444;"></div>
                                    <div style="font-size: 11px; font-weight: 600; color: #1e5f3d; margin-bottom: 5px; word-break: break-word; line-height: 1.2; height: 32px; overflow: hidden;">${file.name}</div>
                                    <div style="font-size: 9px; color: #6b7280; margin-bottom: 8px;">${fileSize} MB</div>
                                    <div style="font-size: 8px; color: #9ca3af;">${uploadDate}</div>
                                </div>
                                <div style="display: flex; gap: 4px; margin-top: 10px; justify-content: center;">
                                    <button onclick="previewSusunanFile(${file.id})" style="background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 9px; cursor: pointer;" title="Preview"></button>
                                    <button onclick="downloadSusunanFile(${file.id})" style="background: #10b981; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 9px; cursor: pointer;" title="Download"></button>
                                    ${userRole === 'admin' ? `<button onclick="hapusFileSusunan(${file.id})" style="background: #ef4444; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 9px; cursor: pointer;" title="Hapus"></button>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Susunan Panitia Functions
        function loadSusunanPanitia() {
            // Display uploaded files
            displaySusunanFiles();
        }



        // Dokumentasi Functions
        function uploadFotoDokumentasi() {
            const fileInput = document.getElementById('uploadDokumentasi');
            const tahunSelect = document.getElementById('tahunDokumentasi');
            const files = fileInput.files;
            
            if (!files || files.length === 0) {
                alert('Pilih foto yang akan diupload!');
                return;
            }
            
            const selectedYear = tahunSelect.value;
            if (!selectedYear) {
                alert('Pilih tahun dokumentasi terlebih dahulu!');
                return;
            }
            
            let uploadedCount = 0;
            let failedCount = 0;
            const totalFiles = files.length;
            const uploadedPhotos = [];
            
            Array.from(files).forEach((file, index) => {
                // Validate file type - JPG/JPEG only
                if (!file.type.match(/^image\/(jpeg|jpg)$/)) {
                    alert(`File ${file.name} bukan format JPG/JPEG!`);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishPhotoUpload();
                    }
                    return;
                }
                
                // Validate file size (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    alert(`File ${file.name} terlalu besar! Maksimal 5MB.`);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishPhotoUpload();
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const photoData = {
                            id: Date.now() + Math.random() * 1000 + index,
                            name: file.name,
                            data: e.target.result,
                            size: file.size,
                            uploadDate: new Date().toISOString(),
                            tahun: selectedYear
                        };
                        
                        dokumentasiData.push(photoData);
                        uploadedPhotos.push(file.name);
                        uploadedCount++;
                        
                        // Save to localStorage immediately for permanent storage
                        localStorage.setItem('dokumentasiData', JSON.stringify(dokumentasiData));
                        
                        if (uploadedCount + failedCount === totalFiles) {
                            finishPhotoUpload();
                        }
                    } catch (error) {
                        console.error('Error processing photo:', error);
                        failedCount++;
                        if (uploadedCount + failedCount === totalFiles) {
                            finishPhotoUpload();
                        }
                    }
                };
                
                reader.onerror = function() {
                    console.error('Error reading photo:', file.name);
                    failedCount++;
                    if (uploadedCount + failedCount === totalFiles) {
                        finishPhotoUpload();
                    }
                };
                
                reader.readAsDataURL(file);
            });
            
            function finishPhotoUpload() {
                // Ensure final save to localStorage for permanent storage
                localStorage.setItem('dokumentasiData', JSON.stringify(dokumentasiData));
                loadDokumentasiGallery();
                fileInput.value = '';
                
                if (uploadedCount > 0) {
                    // Show success notification with photo details
                    let successMessage = ` BERHASIL UPLOAD!\n\n`;
                    successMessage += ` ${uploadedCount} foto berhasil diupload untuk tahun ${selectedYear}\n\n`;
                    successMessage += ` Foto yang diupload:\n`;
                    uploadedPhotos.forEach((photoName, index) => {
                        successMessage += `${index + 1}. ${photoName}\n`;
                    });
                    
                    if (failedCount > 0) {
                        successMessage += `\n ${failedCount} foto gagal diupload`;
                    }
                    
                    successMessage += `\n Data tersimpan permanen di sistem`;
                    
                    alert(successMessage);
                } else {
                    alert(' Tidak ada foto yang berhasil diupload!');
                }
            }
        }

        function loadDokumentasiGallery() {
            displayFilteredDokumentasi(dokumentasiData);
        }

        function filterDokumentasi() {
            const searchTerm = document.getElementById('searchDokumentasi').value.toLowerCase();
            const tahunFilter = document.getElementById('filterTahunDokumentasi').value;
            
            let filteredPhotos = dokumentasiData;
            
            if (searchTerm) {
                filteredPhotos = filteredPhotos.filter(photo => 
                    photo.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (tahunFilter) {
                filteredPhotos = filteredPhotos.filter(photo => photo.tahun === tahunFilter);
            }
            
            displayFilteredDokumentasi(filteredPhotos);
        }

        function displayFilteredDokumentasi(filteredPhotos) {
            const gallery = document.getElementById('dokumentasiGallery');
            const totalFotoSpan = document.getElementById('totalFoto');
            
            if (totalFotoSpan) {
                totalFotoSpan.textContent = dokumentasiData.length;
            }
            
            if (!gallery) {
                console.error('Gallery not found');
                return;
            }
            
            if (filteredPhotos.length === 0) {
                gallery.innerHTML = `
                    <div class="empty-tiles">
                        <div class="empty-tiles-icon"></div>
                        <div class="empty-tiles-title">Belum ada foto dokumentasi</div>
                        <div class="empty-tiles-subtitle">Admin dapat mengupload foto JPG/JPEG tanpa batas melalui form di atas</div>
                    </div>
                `;
                return;
            }
            
            // Change to small icons grid layout
            gallery.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;">
                    ${filteredPhotos.map(photo => {
                        const uploadDate = new Date(photo.uploadDate).toLocaleDateString('id-ID');
                        const fileSize = (photo.size / 1024 / 1024).toFixed(2);
                        
                        return `
                            <div class="small-photo-card" style="background: white; border-radius: 12px; padding: 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.15)'" 
                                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                                <div onclick="openPhotoModal('${photo.id}')" style="cursor: pointer;">
                                    <div style="width: 80px; height: 80px; margin: 0 auto 8px; border-radius: 8px; overflow: hidden; border: 2px solid #e5e7eb;">
                                        <img src="${photo.data}" alt="${photo.name}" style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <div style="font-size: 10px; font-weight: 600; color: #1e5f3d; margin-bottom: 4px; word-break: break-word; line-height: 1.2; height: 24px; overflow: hidden;">${photo.name}</div>
                                    <div style="font-size: 8px; color: #6b7280; margin-bottom: 6px;">${fileSize} MB</div>
                                    <div style="font-size: 7px; color: #9ca3af;">${uploadDate}</div>
                                </div>
                                <div style="display: flex; gap: 3px; margin-top: 8px; justify-content: center;">
                                    <button onclick="openPhotoModal('${photo.id}')" style="background: #3b82f6; color: white; border: none; padding: 3px 6px; border-radius: 3px; font-size: 8px; cursor: pointer;" title="Lihat"></button>
                                    <button onclick="downloadPhoto('${photo.id}')" style="background: #10b981; color: white; border: none; padding: 3px 6px; border-radius: 3px; font-size: 8px; cursor: pointer;" title="Download"></button>
                                    ${userRole === 'admin' ? `<button onclick="deletePhoto('${photo.id}')" style="background: #ef4444; color: white; border: none; padding: 3px 6px; border-radius: 3px; font-size: 8px; cursor: pointer;" title="Hapus"></button>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function openPhotoModal(photoId) {
            const photo = dokumentasiData.find(p => p.id == photoId);
            if (!photo) return;
            
            const modal = document.getElementById('photoModal');
            const modalPhoto = document.getElementById('modalPhoto');
            const modalInfo = document.getElementById('modalPhotoInfo');
            
            modalPhoto.src = photo.data;
            modalInfo.innerHTML = `
                <strong>${photo.name}</strong><br>
                Diupload: ${new Date(photo.uploadDate).toLocaleDateString('id-ID')}<br>
                Ukuran: ${(photo.size / 1024 / 1024).toFixed(2)} MB
            `;
            
            modal.style.display = 'block';
        }

        function closePhotoModal() {
            document.getElementById('photoModal').style.display = 'none';
        }

        function downloadPhoto(photoId) {
            const photo = dokumentasiData.find(p => p.id == photoId);
            if (!photo) return;
            
            const link = document.createElement('a');
            link.href = photo.data;
            link.download = photo.name;
            link.click();
        }

        function deletePhoto(photoId) {
            const photo = dokumentasiData.find(p => p.id == photoId);
            if (!photo) return;
            
            if (!confirm(` KONFIRMASI HAPUS FOTO\n\nApakah Anda yakin ingin menghapus foto ini?\n\n Nama Foto: ${photo.name}\n Diupload: ${new Date(photo.uploadDate).toLocaleDateString('id-ID')}\n Ukuran: ${(photo.size / 1024 / 1024).toFixed(2)} MB\n\n Foto yang dihapus tidak dapat dikembalikan!`)) return;
            
            dokumentasiData = dokumentasiData.filter(p => p.id != photoId);
            localStorage.setItem('dokumentasiData', JSON.stringify(dokumentasiData));
            loadDokumentasiGallery();
            alert(' Foto berhasil dihapus!');
        }

        function downloadAllPhotos() {
            if (dokumentasiData.length === 0) {
                alert('Tidak ada foto untuk didownload!');
                return;
            }
            
            if (confirm(`Download ${dokumentasiData.length} foto? Ini mungkin memakan waktu beberapa saat.`)) {
                dokumentasiData.forEach((photo, index) => {
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = photo.data;
                        link.download = `${index + 1}_${photo.name}`;
                        link.click();
                    }, index * 500); // Delay 500ms between downloads
                });
            }
        }

        function hapusSemuaFileDokumentasi() {
            if (dokumentasiData.length === 0) {
                alert('Tidak ada foto untuk dihapus!');
                return;
            }
            
            if (confirm(` KONFIRMASI HAPUS SEMUA FOTO\n\nApakah Anda yakin ingin menghapus SEMUA ${dokumentasiData.length} foto dokumentasi?\n\n Total Foto: ${dokumentasiData.length}\n Total Ukuran: ${(dokumentasiData.reduce((sum, f) => sum + f.size, 0) / 1024 / 1024).toFixed(2)} MB\n\n Semua foto yang dihapus tidak dapat dikembalikan!\n\n Tindakan ini akan menghapus SELURUH dokumentasi foto!`)) {
                dokumentasiData = [];
                localStorage.setItem('dokumentasiData', JSON.stringify(dokumentasiData));
                loadDokumentasiGallery();
                alert(' Semua foto berhasil dihapus!');
            }
        }

        // Pengaturan Functions
        function simpanPengaturan() {
            try {
                // Get form values
                const namaOrganisasi = document.getElementById('namaOrganisasi');
                const alamatOrganisasi = document.getElementById('alamatOrganisasi');
                const judulLoginUtama = document.getElementById('judulLoginUtama');
                const judulLoginSub = document.getElementById('judulLoginSub');
                const tahunHijriah = document.getElementById('tahunHijriah');
                const tahunMasehi = document.getElementById('tahunMasehi');
                
                if (!namaOrganisasi || !alamatOrganisasi) {
                    alert('Form pengaturan tidak ditemukan!');
                    return;
                }
                
                pengaturanData.namaOrganisasi = namaOrganisasi.value;
                pengaturanData.alamatOrganisasi = alamatOrganisasi.value;
                pengaturanData.judulLoginUtama = judulLoginUtama ? judulLoginUtama.value : 'Sistem Manajemen Qurban';
                pengaturanData.judulLoginSub = judulLoginSub ? judulLoginSub.value : 'Musholla Nurul Falah';
                pengaturanData.tahunHijriah = tahunHijriah ? tahunHijriah.value : currentHijriYear.toString();
                pengaturanData.tahunMasehi = tahunMasehi ? tahunMasehi.value : currentYear.toString();
                
                // Handle logo file if uploaded
                const logoFile = document.getElementById('logoOrganisasi').files[0];
                if (logoFile) {
                    // Check file size (max 2MB)
                    if (logoFile.size > 2 * 1024 * 1024) {
                        alert('Ukuran file terlalu besar! Maksimal 2MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        pengaturanData.logoBase64 = e.target.result;
                        
                        // Save to localStorage
                        localStorage.setItem('pengaturanData', JSON.stringify(pengaturanData));
                        
                        // Update UI elements
                        updateUIWithSettings();
                        updateLogoDisplay();
                        updateLogoPreview();
                        updateDashboard();
                        
                        // Clear file input
                        document.getElementById('logoOrganisasi').value = '';
                        
                        alert('Pengaturan berhasil disimpan!');
                    };
                    reader.readAsDataURL(logoFile);
                } else {
                    // Save without logo change
                    localStorage.setItem('pengaturanData', JSON.stringify(pengaturanData));
                    
                    // Update UI elements
                    updateUIWithSettings();
                    updateDashboard();
                    
                    alert('Pengaturan berhasil disimpan!');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Terjadi kesalahan saat menyimpan pengaturan!');
            }
        }

        function updateUIWithSettings() {
            // Update header
            document.getElementById('headerTitle').textContent = `Sistem Manajemen Qurban`;
            document.getElementById('headerOrganisasi').textContent = pengaturanData.namaOrganisasi;
            document.getElementById('headerAlamat').textContent = pengaturanData.alamatOrganisasi;
            document.getElementById('headerYear').textContent = `Tahun ${pengaturanData.tahunHijriah} H / ${pengaturanData.tahunMasehi} M`;
            
            // Update login page
            document.getElementById('loginTitle').textContent = pengaturanData.judulLoginUtama || 'Sistem Manajemen Qurban';
            document.getElementById('loginSubtitle').textContent = pengaturanData.judulLoginSub || 'Musholla Nurul Falah';
            
            // Update app title
            document.getElementById('appTitle').textContent = `${pengaturanData.judulLoginUtama || 'Sistem Manajemen Qurban'} - ${pengaturanData.namaOrganisasi}`;
        }

        function updateLogoDisplay() {
            // Update header logo
            const headerLogo = document.getElementById('headerLogo');
            if (headerLogo) {
                if (pengaturanData.logoBase64) {
                    headerLogo.innerHTML = `<img src="${pengaturanData.logoBase64}" alt="Logo" class="logo-image-header">`;
                } else {
                    // Default logo SVG
                    headerLogo.innerHTML = `
                        <svg width="50" height="50" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradientHeader" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#1e5f3d"/>
                                    <stop offset="50%" style="stop-color:#2d8659"/>
                                    <stop offset="100%" style="stop-color:#3ea76b"/>
                                </linearGradient>
                                <linearGradient id="goldGradientHeader" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#d4af37"/>
                                    <stop offset="50%" style="stop-color:#f4d03f"/>
                                    <stop offset="100%" style="stop-color:#d4af37"/>
                                </linearGradient>
                            </defs>
                            <circle cx="50" cy="50" r="45" fill="url(#logoGradientHeader)" stroke="url(#goldGradientHeader)" stroke-width="2"/>
                            <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white" opacity="0.95"/>
                            <circle cx="50" cy="55" r="8" fill="url(#logoGradientHeader)"/>
                            <path d="M42 75 L58 75" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            <g opacity="0.3">
                                <path d="M20 20 L30 30 M70 30 L80 20 M20 80 L30 70 M70 70 L80 80" stroke="url(#goldGradientHeader)" stroke-width="1"/>
                            </g>
                        </svg>
                    `;
                }
            }
            
            // Update login logo
            const loginLogo = document.querySelector('.logo-display');
            if (loginLogo) {
                if (pengaturanData.logoBase64) {
                    loginLogo.innerHTML = `
                        <img src="${pengaturanData.logoBase64}" alt="Logo" class="logo-image-login">
                        <div>
                            <h2 id="loginTitle">${pengaturanData.judulLoginUtama || 'Sistem Manajemen Qurban'}</h2>
                            <div id="loginSubtitle" style="color: #1e5f3d; font-size: 16px; margin-top: 3px; font-weight: 600;">${pengaturanData.judulLoginSub || 'Musholla Nurul Falah'}</div>
                        </div>
                    `;
                } else {
                    loginLogo.innerHTML = `
                        <svg width="70" height="70" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradientLogin" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#1e5f3d"/>
                                    <stop offset="50%" style="stop-color:#2d8659"/>
                                    <stop offset="100%" style="stop-color:#3ea76b"/>
                                </linearGradient>
                                <linearGradient id="goldGradientLogin" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#d4af37"/>
                                    <stop offset="50%" style="stop-color:#f4d03f"/>
                                    <stop offset="100%" style="stop-color:#d4af37"/>
                                </linearGradient>
                            </defs>
                            <circle cx="50" cy="50" r="45" fill="url(#logoGradientLogin)" stroke="url(#goldGradientLogin)" stroke-width="2"/>
                            <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white" opacity="0.95"/>
                            <circle cx="50" cy="55" r="8" fill="url(#logoGradientLogin)"/>
                            <path d="M42 75 L58 75" stroke="white" stroke-width="3" stroke-linecap="round"/>
                            <g opacity="0.3">
                                <path d="M20 20 L30 30 M70 30 L80 20 M20 80 L30 70 M70 70 L80 80" stroke="url(#goldGradientLogin)" stroke-width="1"/>
                            </g>
                        </svg>
                        <div>
                            <h1 id="loginTitle">${pengaturanData.judulLoginUtama || 'Sistem Manajemen Qurban'}</h1>
                            <div id="loginSubtitle" style="color: #1e5f3d; font-size: 16px; margin-top: 3px; font-weight: 600;">${pengaturanData.judulLoginSub || 'Musholla Nurul Falah'}</div>
                        </div>
                    `;
                }
            }
        }

        function updateLogoPreview() {
            const currentLogoDisplay = document.getElementById('currentLogoDisplay');
            const logoPreview = document.getElementById('logoPreview');
            
            if (!currentLogoDisplay || !logoPreview) return;
            
            if (pengaturanData.logoBase64) {
                currentLogoDisplay.innerHTML = `<img src="${pengaturanData.logoBase64}" alt="Logo Custom" class="logo-image-preview">`;
                const infoDiv = logoPreview.querySelector('div:last-child');
                if (infoDiv) {
                    infoDiv.textContent = 'Logo Custom';
                }
            } else {
                // Show default logo
                currentLogoDisplay.innerHTML = `
                    <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGradientPreview" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#1e5f3d"/>
                                <stop offset="50%" style="stop-color:#2d8659"/>
                                <stop offset="100%" style="stop-color:#3ea76b"/>
                            </linearGradient>
                            <linearGradient id="goldGradientPreview" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#d4af37"/>
                                <stop offset="50%" style="stop-color:#f4d03f"/>
                                <stop offset="100%" style="stop-color:#d4af37"/>
                            </linearGradient>
                        </defs>
                        <circle cx="50" cy="50" r="45" fill="url(#logoGradientPreview)" stroke="url(#goldGradientPreview)" stroke-width="2"/>
                        <path d="M30 40 L50 25 L70 40 L70 70 L30 70 Z" fill="white" opacity="0.95"/>
                        <circle cx="50" cy="55" r="8" fill="url(#logoGradientPreview)"/>
                        <path d="M42 75 L58 75" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        <g opacity="0.3">
                            <path d="M20 20 L30 30 M70 30 L80 20 M20 80 L30 70 M70 70 L80 80" stroke="url(#goldGradientPreview)" stroke-width="1"/>
                        </g>
                    </svg>
                `;
                const infoDiv = logoPreview.querySelector('div:last-child');
                if (infoDiv) {
                    infoDiv.textContent = 'Logo Default';
                }
            }
        }

        // Add event listener for logo file input
        function setupLogoFileInput() {
            const logoInput = document.getElementById('logoOrganisasi');
            if (logoInput) {
                // Remove existing event listeners
                logoInput.removeEventListener('change', handleLogoChange);
                logoInput.addEventListener('change', handleLogoChange);
            }
        }

        function handleLogoChange(e) {
            const file = e.target.files[0];
            if (file) {
                // Check file size
                if (file.size > 2 * 1024 * 1024) {
                    alert('Ukuran file terlalu besar! Maksimal 2MB.');
                    e.target.value = '';
                    return;
                }
                
                // Check file type
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Format file tidak didukung! Gunakan JPG, PNG, atau GIF.');
                    e.target.value = '';
                    return;
                }
                
                // Preview the selected image
                const reader = new FileReader();
                reader.onload = function(event) {
                    const currentLogoDisplay = document.getElementById('currentLogoDisplay');
                    const logoPreview = document.getElementById('logoPreview');
                    
                    if (currentLogoDisplay) {
                        currentLogoDisplay.innerHTML = `<img src="${event.target.result}" alt="Logo Preview" class="logo-image-preview">`;
                    }
                    if (logoPreview) {
                        const infoDiv = logoPreview.querySelector('div:last-child');
                        if (infoDiv) {
                            infoDiv.textContent = 'Preview Logo Baru';
                        }
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function backupData() {
            const backupData = {
                peserta: pesertaData,
                guru: guruData,
                sapi: sapiData,
                kambing: kambingData,
                mustahik: mustahikData,
                dokumentasi: dokumentasiData,
                susunanFiles: susunanFilesData,
                pengaturan: pengaturanData,
                tanggalBackup: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-qurban-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (confirm('Apakah Anda yakin ingin mengembalikan data? Data saat ini akan diganti!')) {
                        pesertaData = backupData.peserta || [];
                        guruData = backupData.guru || [];
                        sapiData = backupData.sapi || [];
                        kambingData = backupData.kambing || [];
                        mustahikData = backupData.mustahik || [];
                        dokumentasiData = backupData.dokumentasi || [];
                        susunanFilesData = backupData.susunanFiles || backupData.susunanDocument ? [backupData.susunanDocument] : [];
                        pengaturanData = backupData.pengaturan || pengaturanData;
                        
                        // Save to localStorage
                        localStorage.setItem('pesertaData', JSON.stringify(pesertaData));
                        localStorage.setItem('guruData', JSON.stringify(guruData));
                        localStorage.setItem('sapiData', JSON.stringify(sapiData));
                        localStorage.setItem('kambingData', JSON.stringify(kambingData));
                        localStorage.setItem('mustahikData', JSON.stringify(mustahikData));
                        localStorage.setItem('dokumentasiData', JSON.stringify(dokumentasiData));
                        localStorage.setItem('susunanFilesData', JSON.stringify(susunanFilesData));
                        localStorage.setItem('pengaturanData', JSON.stringify(pengaturanData));
                        
                        // Update UI
                        loadPengaturan();
                        updateDashboard();
                        
                        alert('Data berhasil dikembalikan!');
                    }
                } catch (error) {
                    alert('File backup tidak valid!');
                }
            };
            reader.readAsText(file);
        }

        function hapusLogo() {
            if (confirm('Apakah Anda yakin ingin menghapus logo dan kembali ke logo default?')) {
                pengaturanData.logoBase64 = null;
                localStorage.setItem('pengaturanData', JSON.stringify(pengaturanData));
                
                // Clear file input
                const logoInput = document.getElementById('logoOrganisasi');
                if (logoInput) {
                    logoInput.value = '';
                }
                
                // Update displays
                updateLogoDisplay();
                updateLogoPreview();
                
                alert('Logo berhasil dihapus!');
            }
        }

        function loadPengaturan() {
            try {
                const namaOrganisasi = document.getElementById('namaOrganisasi');
                const alamatOrganisasi = document.getElementById('alamatOrganisasi');
                const judulLoginUtama = document.getElementById('judulLoginUtama');
                const judulLoginSub = document.getElementById('judulLoginSub');
                const tahunHijriah = document.getElementById('tahunHijriah');
                const tahunMasehi = document.getElementById('tahunMasehi');
                
                if (namaOrganisasi) namaOrganisasi.value = pengaturanData.namaOrganisasi || 'Musholla Nurul Falah';
                if (alamatOrganisasi) alamatOrganisasi.value = pengaturanData.alamatOrganisasi || 'Jl. Pahlawan RT.010/04 Sukabumi Selatan Kebon Jeruk Jakarta Barat';
                if (judulLoginUtama) judulLoginUtama.value = pengaturanData.judulLoginUtama || 'Sistem Manajemen Qurban';
                if (judulLoginSub) judulLoginSub.value = pengaturanData.judulLoginSub || 'Musholla Nurul Falah';
                if (tahunHijriah) tahunHijriah.value = pengaturanData.tahunHijriah || currentHijriYear.toString();
                if (tahunMasehi) tahunMasehi.value = pengaturanData.tahunMasehi || currentYear.toString();
                
                // Update UI with loaded settings
                updateUIWithSettings();
                updateLogoDisplay();
                updateLogoPreview();
                setupLogoFileInput();
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Event Listeners
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('pesertaForm').addEventListener('submit', handlePesertaSubmit);
        document.getElementById('guruForm').addEventListener('submit', handleGuruSubmit);
        document.getElementById('sapiForm').addEventListener('submit', handleSapiSubmit);
        document.getElementById('kambingForm').addEventListener('submit', handleKambingSubmit);
        document.getElementById('pembagianForm').addEventListener('submit', handlePembagianSubmit);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Service Worker Registration for Offline Support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swCode = `
                    const CACHE_NAME = 'qurban-app-v1';
                    const urlsToCache = [
                        '/',
                        'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js'
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                }
                            )
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Connection Status Monitor
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (navigator.onLine) {
                statusElement.innerHTML = ' Online';
                statusElement.style.color = '#10b981';
            } else {
                statusElement.innerHTML = ' Offline';
                statusElement.style.color = '#ef4444';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeYearDropdowns();
            loadPengaturan();
            updateLogoDisplay(); // Initialize logo display
            updateDashboard();
            
            // Setup logout button with proper event listener
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.removeEventListener('click', logout); // Remove any existing listeners
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
            
            // Setup settings save button
            setTimeout(() => {
                const saveSettingsBtn = document.querySelector('button[onclick="simpanPengaturan()"]');
                if (saveSettingsBtn) {
                    saveSettingsBtn.removeAttribute('onclick'); // Remove inline onclick
                    saveSettingsBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        simpanPengaturan();
                    });
                }
                
                // Setup logo file input
                setupLogoFileInput();
                
                // Initialize upload sections
                loadSusunanPanitia();
                loadDokumentasiGallery();
            }, 100);
            
            // Monitor connection status
            updateConnectionStatus();
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989945820595df9f',t:'MTc1OTYyOTA2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
